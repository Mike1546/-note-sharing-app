{"version":3,"file":"static/js/638.8c169b57.chunk.js","mappings":"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","sources":["services/passwords.js","services/logs.js","components/admin/AdminPortal.js","services/groups.js"],"sourcesContent":["import CryptoJS from 'crypto-js';\r\nimport { databases } from '../appwrite';\r\nimport { Query, ID } from 'appwrite';\r\n\r\n// Build timestamp: 2025-02-28 v7\r\nconst DATABASE_ID = process.env.REACT_APP_APPWRITE_DATABASE_ID || '69181c670024df0dd32b';\r\nconst PASSWORDS_COLLECTION_ID = process.env.REACT_APP_APPWRITE_COLLECTION_PASSWORDS || '6918f63900228f33e93c';\r\nconst ENCRYPTION_KEY = process.env.REACT_APP_ENCRYPTION_KEY || 'LOCAL_DEVELOPMENT_KEY';\r\n\r\nfunction encrypt(text) {\r\n  return CryptoJS.AES.encrypt(text, ENCRYPTION_KEY).toString();\r\n}\r\n\r\nfunction decrypt(cipher) {\r\n  const bytes = CryptoJS.AES.decrypt(cipher, ENCRYPTION_KEY);\r\n  return bytes.toString(CryptoJS.enc.Utf8);\r\n}\r\n\r\n// Create password without document-level permissions (using collection-level)\r\nexport async function createPassword(userId, entry) {\r\n  console.log('[Password Manager] Creating password entry', { userId, entry, collectionId: PASSWORDS_COLLECTION_ID });\r\n  \r\n  if (!entry.title) {\r\n    throw new Error('Title is required');\r\n  }\r\n  \r\n  const payload = { ...entry, ownerId: userId };\r\n  if (entry.password) {\r\n    payload.encryptedPassword = encrypt(entry.password);\r\n    delete payload.password;\r\n  }\r\n  \r\n  // Ensure required fields are present\r\n  if (!payload.encryptedPassword) {\r\n    throw new Error('Password is required');\r\n  }\r\n  \r\n  try {\r\n    const result = await databases.createDocument(\r\n      DATABASE_ID,\r\n      PASSWORDS_COLLECTION_ID,\r\n      ID.unique(),\r\n      payload\r\n    );\r\n    console.log('[Password Manager] Password created successfully', result.$id);\r\n    return result;\r\n  } catch (error) {\r\n    console.error('[Password Manager] Create error:', error);\r\n    console.error('[Password Manager] Error details:', {\r\n      message: error.message,\r\n      code: error.code,\r\n      type: error.type,\r\n      response: error.response\r\n    });\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function listPasswords(userId = null) {\r\n  try {\r\n    // If userId is provided, filter by owner. If null, list all (for admin)\r\n    const queries = userId ? [Query.equal('ownerId', userId)] : [];\r\n    const response = await databases.listDocuments(\r\n      DATABASE_ID,\r\n      PASSWORDS_COLLECTION_ID,\r\n      queries\r\n    );\r\n    const entries = response.documents || [];\r\n    \r\n    // Enrich entries with owner profile information\r\n    const PROFILES_COLLECTION_ID = process.env.REACT_APP_APPWRITE_COLLECTION_PROFILES || '6918f632002d42536ab2';\r\n    const enrichedEntries = await Promise.all(entries.map(async (entry) => {\r\n      if (!entry.ownerId) {\r\n        return entry;\r\n      }\r\n      \r\n      try {\r\n        const profiles = await databases.listDocuments(\r\n          DATABASE_ID,\r\n          PROFILES_COLLECTION_ID,\r\n          [Query.equal('userId', entry.ownerId)]\r\n        );\r\n        \r\n        if (profiles.documents && profiles.documents.length > 0) {\r\n          const profile = profiles.documents[0];\r\n          return {\r\n            ...entry,\r\n            owner: {\r\n              name: profile.name || profile.email || 'Unknown',\r\n              email: profile.email || ''\r\n            }\r\n          };\r\n        }\r\n        return {\r\n          ...entry,\r\n          owner: {\r\n            name: 'Unknown User',\r\n            email: ''\r\n          }\r\n        };\r\n      } catch (err) {\r\n        console.warn(`Failed to fetch profile for owner ${entry.ownerId}:`, err);\r\n        return {\r\n          ...entry,\r\n          owner: {\r\n            name: 'Unknown User',\r\n            email: ''\r\n          }\r\n        };\r\n      }\r\n    }));\r\n    \r\n    return enrichedEntries;\r\n  } catch (err) {\r\n    console.warn('Failed to fetch passwords:', err);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function deletePassword(documentId) {\r\n  return databases.deleteDocument(DATABASE_ID, PASSWORDS_COLLECTION_ID, documentId);\r\n}\r\n\r\nexport async function getDecryptedPassword(encrypted) {\r\n  try {\r\n    return decrypt(encrypted);\r\n  } catch (e) {\r\n    console.error('Decrypt error', e);\r\n    throw e;\r\n  }\r\n}\r\n\r\nexport default { createPassword, listPasswords, getDecryptedPassword, deletePassword };\r\n","import { databases } from '../appwrite';\r\n\r\nconst DATABASE_ID = process.env.REACT_APP_APPWRITE_DATABASE_ID || '69181c670024df0dd32b';\r\nconst LOGS_COLLECTION_ID = process.env.REACT_APP_APPWRITE_COLLECTION_LOGS || '691fc47f00242f9c53a4';\r\n\r\nexport async function listLogs() {\r\n  try {\r\n    const res = await databases.listDocuments(DATABASE_ID, LOGS_COLLECTION_ID);\r\n    return res.documents || [];\r\n  } catch (error) {\r\n    // If collection doesn't exist, return empty array instead of throwing\r\n    if (error.code === 404 || error.message?.includes('not be found')) {\r\n      console.warn('[Logs] Collection not found, returning empty array');\r\n      return [];\r\n    }\r\n    console.error('[Logs] Error fetching logs:', error.message || error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport default { listLogs };\r\n","import React, { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n  Container,\r\n  Box,\r\n  Typography,\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableContainer,\r\n  TableHead,\r\n  TableRow,\r\n  Paper,\r\n  Button,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  TextField,\r\n  Alert,\r\n  Tabs,\r\n  Tab,\r\n  IconButton,\r\n  Chip,\r\n  Switch,\r\n  FormControlLabel,\r\n  Snackbar,\r\n  AppBar,\r\n  Toolbar\r\n} from '@mui/material';\r\nimport {\r\n  Delete as DeleteIcon,\r\n  Edit as EditIcon,\r\n  Key as KeyIcon,\r\n  Visibility as VisibilityIcon,\r\n  VisibilityOff as VisibilityOffIcon,\r\n  Lock as LockIcon,\r\n  Refresh as RefreshIcon,\r\n  ArrowBack as ArrowBackIcon,\r\n  Add as AddIcon\r\n} from '@mui/icons-material';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport profilesService from '../../services/profiles';\r\nimport passwordsService from '../../services/passwords';\r\nimport groupsService from '../../services/groups';\r\nimport logsService from '../../services/logs';\r\n\r\nconst AdminPortal = () => {\r\n  const { user } = useAuth();\r\n  const [activeTab, setActiveTab] = useState(0);\r\n  const [users, setUsers] = useState([]);\r\n  const [passwordEntries, setPasswordEntries] = useState([]);\r\n  const [groups, setGroups] = useState([]);\r\n  const [error, setError] = useState('');\r\n  const [success, setSuccess] = useState('');\r\n  const [selectedUser, setSelectedUser] = useState(null);\r\n  const [selectedEntry, setSelectedEntry] = useState(null);\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState({});\r\n  const [decryptedPasswords, setDecryptedPasswords] = useState({});\r\n  const [dialogOpen, setDialogOpen] = useState(false);\r\n  const [dialogType, setDialogType] = useState('');\r\n  const [editUserData, setEditUserData] = useState({\r\n    name: '',\r\n    email: '',\r\n    isAdmin: false\r\n  });\r\n  const [newUserData, setNewUserData] = useState({\r\n    name: '',\r\n    email: '',\r\n    password: '',\r\n    role: 'user'\r\n  });\r\n  const [loginLogs, setLoginLogs] = useState([]);\r\n  const [snackbar, setSnackbar] = useState({ open: false, message: '', severity: 'success' });\r\n\r\n  const fetchData = useCallback(async () => {\r\n    try {\r\n      switch (activeTab) {\r\n        case 0:\r\n          await fetchUsers();\r\n          break;\r\n        case 1:\r\n          await fetchPasswordEntries();\r\n          break;\r\n        case 2:\r\n          await fetchGroups();\r\n          break;\r\n        case 3:\r\n          await fetchLoginLogs();\r\n          break;\r\n        default:\r\n          console.log('Unknown tab selected');\r\n          break;\r\n      }\r\n    } catch (err) {\r\n      setError('Failed to fetch data');\r\n    }\r\n  }, [activeTab]);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [fetchData]);\r\n\r\n  const fetchUsers = async () => {\r\n    try {\r\n      const docs = await profilesService.listProfiles();\r\n      const mapped = (Array.isArray(docs) ? docs : (docs.documents || [])).map(doc => ({\r\n        _id: doc.$id,\r\n        userId: doc.userId,\r\n        name: doc.name || '',\r\n        email: doc.email || '',\r\n        role: doc.role || 'user',\r\n        hasProfile: true\r\n      }));\r\n      setUsers(mapped);\r\n      if (mapped.length === 0) {\r\n        console.warn('[AdminPortal] No users found in profiles collection');\r\n        console.warn('[AdminPortal] Some users may exist in Appwrite but not have profiles');\r\n        console.warn('[AdminPortal] Run: node scripts/syncUsersToProfiles.js to sync all users');\r\n      } else {\r\n        console.log(`[AdminPortal] Loaded ${mapped.length} users with profiles`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching users:', error);\r\n      showSnackbar('Error fetching users: ' + (error.message || 'Unknown error'), 'error');\r\n    }\r\n  };\r\n\r\n  const fetchPasswordEntries = async () => {\r\n    try {\r\n      // Pass null to list all passwords (admin access)\r\n      const res = await passwordsService.listPasswords(null);\r\n      const mapped = (Array.isArray(res) ? res : (res.documents || [])).map(d => ({\r\n        _id: d.$id || d._id,\r\n        title: d.title,\r\n        username: d.username,\r\n        password_encrypted: d.encryptedPassword || d.password_encrypted,\r\n        owner: d.owner || (d.ownerId ? { name: d.ownerId, email: '' } : null),\r\n        group: d.group || d.groupId || null,\r\n        ...d\r\n      }));\r\n      setPasswordEntries(mapped);\r\n    } catch (error) {\r\n      console.error('Error fetching password entries:', error);\r\n      showSnackbar('Error fetching password entries: ' + (error.message || 'Unknown error'), 'error');\r\n    }\r\n  };\r\n\r\n  const fetchGroups = async () => {\r\n    try {\r\n      const res = await groupsService.listGroups();\r\n      const mapped = (Array.isArray(res) ? res : (res.documents || [])).map(d => ({\r\n        _id: d.$id || d._id,\r\n        name: d.name,\r\n        owner: d.owner || d.ownerId || null,\r\n        members: d.members || []\r\n      }));\r\n      setGroups(mapped);\r\n    } catch (error) {\r\n      console.error('Error fetching groups:', error);\r\n      showSnackbar('Error fetching groups: ' + (error.message || 'Unknown error'), 'error');\r\n    }\r\n  };\r\n\r\n  const fetchLoginLogs = async () => {\r\n    try {\r\n      const res = await logsService.listLogs();\r\n      const mapped = (Array.isArray(res) ? res : (res.documents || [])).map(d => ({\r\n        _id: d.$id || d._id,\r\n        userName: d.userName || d.name || '',\r\n        userEmail: d.userEmail || d.email || '',\r\n        timestamp: d.timestamp || d.$createdAt,\r\n        ipAddress: d.ipAddress || 'N/A',\r\n        success: d.success !== undefined ? d.success : true\r\n      }));\r\n      setLoginLogs(mapped);\r\n      if (mapped.length === 0) {\r\n        console.log('[AdminPortal] No login logs found (collection may not exist)');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching login logs:', error);\r\n      // Don't show error if collection doesn't exist - it's optional\r\n      if (!error.message?.includes('not be found') && error.code !== 404) {\r\n        showSnackbar('Error fetching login logs: ' + (error.message || 'Unknown error'), 'error');\r\n      } else {\r\n        setLoginLogs([]); // Set empty array if collection doesn't exist\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleCreateUser = () => {\r\n    setNewUserData({ name: '', email: '', password: '', role: 'user' });\r\n    setDialogType('createUser');\r\n    setDialogOpen(true);\r\n  };\r\n\r\n  const handleCreateUserSubmit = async () => {\r\n    try {\r\n      if (!newUserData.name || !newUserData.email || !newUserData.password) {\r\n        setError('All fields are required');\r\n        return;\r\n      }\r\n      if (newUserData.password.length < 6) {\r\n        setError('Password must be at least 6 characters long');\r\n        return;\r\n      }\r\n\r\n      // User creation requires server-side API key\r\n      // For now, show instructions\r\n      const instructions = `To create user \"${newUserData.email}\":\\n\\n` +\r\n        `Run this command:\\n` +\r\n        `node scripts/createUser.js \"${newUserData.name}\" \"${newUserData.email}\" \"${newUserData.password}\" \"${newUserData.role}\"\\n\\n` +\r\n        `Make sure APPWRITE_API_KEY is set in your environment.`;\r\n      \r\n      alert(instructions);\r\n      showSnackbar('See alert for user creation instructions', 'info');\r\n      setDialogOpen(false);\r\n      setNewUserData({ name: '', email: '', password: '', role: 'user' });\r\n      \r\n      // Refresh user list after a moment (in case user runs the script)\r\n      setTimeout(() => {\r\n        fetchUsers();\r\n      }, 2000);\r\n    } catch (err) {\r\n      setError(err.response?.data?.message || 'Failed to create user');\r\n    }\r\n  };\r\n\r\n  const handleEditUser = (user) => {\r\n    setSelectedUser(user);\r\n    setEditUserData({\r\n      name: user.name,\r\n      email: user.email,\r\n      isAdmin: user.role === 'admin'\r\n    });\r\n    setDialogType('editUser');\r\n    setDialogOpen(true);\r\n  };\r\n\r\n  const handleUpdateUser = async () => {\r\n    try {\r\n      if (selectedUser._id) {\r\n        const newRole = editUserData.isAdmin ? 'admin' : 'user';\r\n        await profilesService.updateProfileRole(selectedUser._id, newRole);\r\n        setSuccess('User role updated successfully');\r\n      }\r\n      setDialogOpen(false);\r\n      fetchUsers();\r\n    } catch (err) {\r\n      setError('Failed to update user');\r\n    }\r\n  };\r\n\r\n  const handleDeleteUser = async (userId) => {\r\n    if (!window.confirm('Are you sure? This will delete all user data including passwords and groups.')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      showSnackbar('To delete a user, use the Appwrite console or run a server-side admin script.', 'info');\r\n    } catch (err) {\r\n      setError('Failed to initiate delete');\r\n    }\r\n  };\r\n\r\n  const handleChangePassword = async () => {\r\n    try {\r\n      if (!newPassword || newPassword.length < 6) {\r\n        setError('Password must be at least 6 characters long');\r\n        return;\r\n      }\r\n      \r\n      // Admins can reset any password, including other admins\r\n      // Changing a user's account password requires server-side privileges with Appwrite API key.\r\n      const userRole = selectedUser?.role || 'user';\r\n      const isAdminUser = userRole === 'admin';\r\n      const instructions = `To reset password for ${selectedUser?.email}${isAdminUser ? ' (Admin)' : ''}:\\n\\n` +\r\n        `Run this command:\\n` +\r\n        `node scripts/resetUserPassword.js \"${selectedUser?.email}\" \"${newPassword}\"\\n\\n` +\r\n        `Note: As an admin, you can reset any user's password, including other admins.\\n` +\r\n        `Make sure APPWRITE_API_KEY is set in your environment.`;\r\n      \r\n      alert(instructions);\r\n      showSnackbar('See alert for password reset instructions', 'info');\r\n      setDialogOpen(false);\r\n      setNewPassword('');\r\n      setDialogType('');\r\n    } catch (err) {\r\n      setError(err.response?.data?.message || 'Failed to change password');\r\n    }\r\n  };\r\n\r\n  const handlePasswordChange = (user) => {\r\n    setSelectedUser(user);\r\n    setDialogType('changePassword');\r\n    setDialogOpen(true);\r\n  };\r\n\r\n  const handleDeletePasswordEntry = async (entryId) => {\r\n    if (!window.confirm('Are you sure you want to delete this password entry?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await passwordsService.deletePassword(entryId);\r\n      setSuccess('Password entry deleted successfully');\r\n      fetchPasswordEntries();\r\n    } catch (err) {\r\n      setError('Failed to delete password entry');\r\n    }\r\n  };\r\n\r\n  const handleDeleteGroup = async (groupId) => {\r\n    if (!window.confirm('Are you sure you want to delete this group?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await groupsService.deleteGroup(groupId);\r\n      setSuccess('Group deleted successfully');\r\n      fetchGroups();\r\n    } catch (err) {\r\n      setError('Failed to delete group');\r\n    }\r\n  };\r\n\r\n  const handleCloseDialog = () => {\r\n    setDialogOpen(false);\r\n    setNewPassword('');\r\n    setSelectedUser(null);\r\n    setSelectedEntry(null);\r\n    setEditUserData({ name: '', email: '', isAdmin: false });\r\n    setNewUserData({ name: '', email: '', password: '', role: 'user' });\r\n  };\r\n\r\n  const showSnackbar = (message, severity = 'success') => {\r\n    setSnackbar({ open: true, message, severity });\r\n  };\r\n\r\n  const handleSnackbarClose = () => {\r\n    setSnackbar({ ...snackbar, open: false });\r\n  };\r\n\r\n  const handleBack = () => {\r\n    window.history.back();\r\n  };\r\n\r\n  const role = user?.profile?.role || 'user';\r\n  if (role !== 'admin' && role !== 'developer') {\r\n    return (\r\n      <Container>\r\n        <Typography variant=\"h4\" sx={{ mt: 4, mb: 2 }}>\r\n          Access Denied\r\n        </Typography>\r\n        <Typography>\r\n          You do not have permission to access the admin portal.\r\n        </Typography>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <AppBar position=\"static\" color=\"transparent\" elevation={0}>\r\n        <Toolbar>\r\n          <IconButton\r\n            edge=\"start\"\r\n            color=\"inherit\"\r\n            onClick={handleBack}\r\n            sx={{ mr: 2 }}\r\n          >\r\n            <ArrowBackIcon />\r\n          </IconButton>\r\n          <Typography variant=\"h6\" component=\"div\" sx={{ flexGrow: 1 }}>\r\n            Admin Portal\r\n          </Typography>\r\n        </Toolbar>\r\n      </AppBar>\r\n      \r\n      <Container maxWidth=\"xl\">\r\n        <Box sx={{ \r\n          display: 'flex', \r\n          flexDirection: 'column',\r\n          gap: 2,\r\n          py: 4\r\n        }}>\r\n          <Typography \r\n            variant=\"h4\" \r\n            sx={{ \r\n              fontWeight: 'medium',\r\n              color: 'primary.main',\r\n              mb: 1\r\n            }}\r\n          >\r\n            Admin Portal\r\n          </Typography>\r\n\r\n          {error && (\r\n            <Alert \r\n              severity=\"error\" \r\n              variant=\"outlined\"\r\n              sx={{ \r\n                '& .MuiAlert-message': { \r\n                  display: 'flex', \r\n                  alignItems: 'center' \r\n                } \r\n              }}\r\n            >\r\n              {error}\r\n            </Alert>\r\n          )}\r\n          \r\n          {success && (\r\n            <Alert \r\n              severity=\"success\"\r\n              variant=\"outlined\"\r\n              sx={{ \r\n                '& .MuiAlert-message': { \r\n                  display: 'flex', \r\n                  alignItems: 'center' \r\n                } \r\n              }}\r\n            >\r\n              {success}\r\n            </Alert>\r\n          )}\r\n\r\n          <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 2 }}>\r\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n              <Tabs \r\n                value={activeTab} \r\n                onChange={(e, newValue) => setActiveTab(newValue)}\r\n                sx={{ \r\n                  '& .MuiTab-root': {\r\n                    textTransform: 'none',\r\n                    fontSize: '0.95rem',\r\n                    minHeight: 48,\r\n                    py: 0\r\n                  }\r\n                }}\r\n              >\r\n                <Tab label=\"Users\" />\r\n                <Tab label=\"Password Entries\" />\r\n                <Tab label=\"Groups\" />\r\n                <Tab label=\"Login Logs\" />\r\n              </Tabs>\r\n              {activeTab === 0 && (\r\n                <Button\r\n                  variant=\"contained\"\r\n                  color=\"primary\"\r\n                  startIcon={<AddIcon />}\r\n                  onClick={handleCreateUser}\r\n                  sx={{ ml: 2 }}\r\n                >\r\n                  Create User\r\n                </Button>\r\n              )}\r\n            </Box>\r\n          </Box>\r\n\r\n          <TableContainer \r\n            component={Paper}\r\n            sx={{ \r\n              boxShadow: 2,\r\n              borderRadius: 1,\r\n              overflow: 'hidden'\r\n            }}\r\n          >\r\n            <Table size=\"small\">\r\n              {activeTab === 0 && (\r\n                <>\r\n                  <TableHead>\r\n                    <TableRow>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Name</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Email</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Role</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Actions</TableCell>\r\n                    </TableRow>\r\n                  </TableHead>\r\n                  <TableBody>\r\n                    {users.length === 0 ? (\r\n                      <TableRow>\r\n                        <TableCell colSpan={4} align=\"center\" sx={{ py: 4 }}>\r\n                          <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 2 }}>\r\n                            No users found in profiles collection\r\n                          </Typography>\r\n                          <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', mb: 1 }}>\r\n                            Some users may exist in Appwrite but don't have profiles yet.\r\n                          </Typography>\r\n                          <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', fontFamily: 'monospace', mb: 2 }}>\r\n                            Run: node scripts/syncUsersToProfiles.js\r\n                          </Typography>\r\n                          <Button\r\n                            variant=\"outlined\"\r\n                            size=\"small\"\r\n                            onClick={() => {\r\n                              const instructions = `To sync all Appwrite users to profiles:\\n\\n` +\r\n                                `Run this command:\\n` +\r\n                                `node scripts/syncUsersToProfiles.js\\n\\n` +\r\n                                `Make sure APPWRITE_API_KEY is set in your environment.`;\r\n                              alert(instructions);\r\n                            }}\r\n                          >\r\n                            Show Sync Instructions\r\n                          </Button>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ) : (\r\n                      users.map((user) => (\r\n                        <TableRow key={user._id || user.userId}>\r\n                          <TableCell sx={{ minWidth: 120 }}>{user.name || 'N/A'}</TableCell>\r\n                          <TableCell sx={{ minWidth: 180 }}>{user.email || 'N/A'}</TableCell>\r\n                          <TableCell sx={{ minWidth: 100 }}>\r\n                            <Chip \r\n                              label={user.role ? user.role.charAt(0).toUpperCase() + user.role.slice(1) : 'User'}\r\n                              color={user.role === 'developer' ? 'secondary' : (user.role === 'admin' ? 'primary' : 'default')}\r\n                              size=\"small\"\r\n                              sx={{ fontSize: '0.75rem', height: '24px' }}\r\n                            />\r\n                          </TableCell>\r\n                          <TableCell>\r\n                            <IconButton\r\n                              size=\"small\"\r\n                              onClick={() => handlePasswordChange(user)}\r\n                              color=\"primary\"\r\n                              title={`Reset password for ${user.email}${user.role === 'admin' ? ' (Admin)' : ''}. Admins can reset any password, including other admins.`}\r\n                            >\r\n                              <KeyIcon />\r\n                            </IconButton>\r\n                            <IconButton\r\n                              size=\"small\"\r\n                              onClick={() => handleEditUser(user)}\r\n                              color=\"primary\"\r\n                              title=\"Edit user\"\r\n                            >\r\n                              <EditIcon />\r\n                            </IconButton>\r\n                            <IconButton\r\n                              size=\"small\"\r\n                              onClick={() => handleDeleteUser(user._id)}\r\n                              color=\"error\"\r\n                              title=\"Delete user\"\r\n                            >\r\n                              <DeleteIcon />\r\n                            </IconButton>\r\n                          </TableCell>\r\n                        </TableRow>\r\n                      ))\r\n                    )}\r\n                  </TableBody>\r\n                </>\r\n              )}\r\n\r\n              {activeTab === 1 && (\r\n                <>\r\n                  <TableHead>\r\n                    <TableRow>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Title</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Username</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Password</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Owner</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Group</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Actions</TableCell>\r\n                    </TableRow>\r\n                  </TableHead>\r\n                  <TableBody>\r\n                    {passwordEntries.map((entry) => (\r\n                      <TableRow key={entry._id}>\r\n                        <TableCell sx={{ minWidth: 150 }}>{entry.title}</TableCell>\r\n                        <TableCell sx={{ minWidth: 120 }}>{entry.username}</TableCell>\r\n                        <TableCell sx={{ minWidth: 150 }}>\r\n                          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                            <Typography sx={{ fontFamily: 'monospace' }}>\r\n                              {showPassword[entry._id] ? (decryptedPasswords[entry._id] || 'Decrypting...') : ''}\r\n                            </Typography>\r\n                            <IconButton\r\n                              size=\"small\"\r\n                              onClick={async () => {\r\n                                const currently = !!showPassword[entry._id];\r\n                                if (!currently) {\r\n                                  // showing now: decrypt first if needed\r\n                                  if (!decryptedPasswords[entry._id] && entry.password_encrypted) {\r\n                                    try {\r\n                                      const plain = await passwordsService.getDecryptedPassword(entry.password_encrypted);\r\n                                      setDecryptedPasswords(prev => ({ ...prev, [entry._id]: plain }));\r\n                                    } catch (e) {\r\n                                      setDecryptedPasswords(prev => ({ ...prev, [entry._id]: 'Error' }));\r\n                                    }\r\n                                  }\r\n                                }\r\n                                setShowPassword(prev => ({ ...prev, [entry._id]: !prev[entry._id] }));\r\n                              }}\r\n                            >\r\n                              {showPassword[entry._id] ? <VisibilityOffIcon fontSize=\"small\" /> : <VisibilityIcon fontSize=\"small\" />}\r\n                            </IconButton>\r\n                          </Box>\r\n                        </TableCell>\r\n                        <TableCell sx={{ minWidth: 120 }}>\r\n                          {entry.owner?.name || (typeof entry.owner === 'string' ? entry.owner : 'Unknown')}\r\n                        </TableCell>\r\n                        <TableCell sx={{ minWidth: 120 }}>{entry.group?.name || '-'}</TableCell>\r\n                        <TableCell>\r\n                          <IconButton \r\n                            onClick={() => handleDeletePasswordEntry(entry._id)}\r\n                            size=\"small\"\r\n                            color=\"error\"\r\n                          >\r\n                            <DeleteIcon fontSize=\"small\" />\r\n                          </IconButton>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </>\r\n              )}\r\n\r\n              {activeTab === 2 && (\r\n                <>\r\n                  <TableHead>\r\n                    <TableRow>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Name</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Owner</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Members</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Actions</TableCell>\r\n                    </TableRow>\r\n                  </TableHead>\r\n                  <TableBody>\r\n                    {groups.map((group) => (\r\n                      <TableRow key={group._id}>\r\n                        <TableCell sx={{ minWidth: 150 }}>{group.name}</TableCell>\r\n                        <TableCell sx={{ minWidth: 120 }}>{group.owner?.name}</TableCell>\r\n                        <TableCell sx={{ minWidth: 200 }}>\r\n                          <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}>\r\n                            {group.members.map(member => (\r\n                              <Chip\r\n                                key={member.user._id}\r\n                                label={`${member.user.name} (${member.role})`}\r\n                                size=\"small\"\r\n                                color={member.role === 'admin' ? 'primary' : 'default'}\r\n                                sx={{ \r\n                                  fontSize: '0.75rem',\r\n                                  height: '24px'\r\n                                }}\r\n                              />\r\n                            ))}\r\n                          </Box>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <IconButton \r\n                            onClick={() => handleDeleteGroup(group._id)}\r\n                            size=\"small\"\r\n                            color=\"error\"\r\n                          >\r\n                            <DeleteIcon fontSize=\"small\" />\r\n                          </IconButton>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </>\r\n              )}\r\n\r\n              {activeTab === 3 && (\r\n                <>\r\n                  <TableHead>\r\n                    <TableRow>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>User</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Email</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Timestamp</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>IP Address</TableCell>\r\n                      <TableCell sx={{ fontWeight: 'bold' }}>Status</TableCell>\r\n                    </TableRow>\r\n                  </TableHead>\r\n                  <TableBody>\r\n                    {loginLogs.map((log) => (\r\n                      <TableRow key={log._id}>\r\n                        <TableCell sx={{ minWidth: 120 }}>{log.userName}</TableCell>\r\n                        <TableCell sx={{ minWidth: 180 }}>{log.userEmail}</TableCell>\r\n                        <TableCell sx={{ minWidth: 160, fontFamily: 'monospace' }}>\r\n                          {new Date(log.timestamp).toLocaleString()}\r\n                        </TableCell>\r\n                        <TableCell sx={{ minWidth: 120, fontFamily: 'monospace' }}>{log.ipAddress}</TableCell>\r\n                        <TableCell sx={{ minWidth: 100 }}>\r\n                          <Chip\r\n                            label={log.success ? 'Success' : 'Failed'}\r\n                            color={log.success ? 'success' : 'error'}\r\n                            size=\"small\"\r\n                            sx={{ \r\n                              fontSize: '0.75rem',\r\n                              height: '24px',\r\n                              minWidth: '80px'\r\n                            }}\r\n                          />\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </>\r\n              )}\r\n            </Table>\r\n          </TableContainer>\r\n        </Box>\r\n\r\n        <Dialog \r\n          open={dialogOpen && dialogType === 'changePassword'} \r\n          onClose={handleCloseDialog}\r\n          maxWidth=\"sm\"\r\n          fullWidth\r\n        >\r\n          <DialogTitle>\r\n            Change Password for {selectedUser?.name}\r\n            {selectedUser?.role === 'admin' && (\r\n              <Chip \r\n                label=\"Admin\" \r\n                color=\"primary\" \r\n                size=\"small\" \r\n                sx={{ ml: 1, fontSize: '0.7rem', height: '20px' }}\r\n              />\r\n            )}\r\n          </DialogTitle>\r\n          <DialogContent>\r\n            <Box sx={{ pt: 2 }}>\r\n              {selectedUser?.role === 'admin' && (\r\n                <Box sx={{ mb: 2, p: 1.5, bgcolor: 'info.light', borderRadius: 1, border: '1px solid', borderColor: 'info.main' }}>\r\n                  <Typography variant=\"body2\" sx={{ fontWeight: 'medium', mb: 0.5 }}>\r\n                    Admin Password Reset\r\n                  </Typography>\r\n                  <Typography variant=\"caption\" color=\"text.secondary\">\r\n                    As an admin, you can reset any user's password, including other admins. Only admins have this privilege.\r\n                  </Typography>\r\n                </Box>\r\n              )}\r\n              <TextField\r\n                fullWidth\r\n                type=\"password\"\r\n                label=\"New Password\"\r\n                value={newPassword}\r\n                onChange={(e) => setNewPassword(e.target.value)}\r\n                margin=\"dense\"\r\n                autoFocus\r\n                error={!!error && error.includes('Password')}\r\n                helperText={error && error.includes('Password') ? error : 'Minimum 6 characters'}\r\n              />\r\n            </Box>\r\n          </DialogContent>\r\n          <DialogActions>\r\n            <Button onClick={handleCloseDialog}>Cancel</Button>\r\n            <Button \r\n              onClick={handleChangePassword} \r\n              variant=\"contained\"\r\n              disabled={!newPassword || newPassword.length < 6}\r\n            >\r\n              Change Password\r\n            </Button>\r\n          </DialogActions>\r\n        </Dialog>\r\n\r\n        <Dialog \r\n          open={dialogOpen} \r\n          onClose={handleCloseDialog}\r\n          maxWidth=\"sm\"\r\n          fullWidth\r\n          PaperProps={{\r\n            sx: {\r\n              borderRadius: 1,\r\n              boxShadow: 3\r\n            }\r\n          }}\r\n        >\r\n          <DialogTitle sx={{ pb: 1 }}>\r\n            {dialogType === 'createUser' ? 'Create New User' : \r\n             dialogType === 'editUser' ? 'Edit User' : 'Change Password'}\r\n          </DialogTitle>\r\n          <DialogContent sx={{ pb: 2 }}>\r\n            {dialogType === 'createUser' ? (\r\n              <Box sx={{ pt: 2 }}>\r\n                <TextField\r\n                  fullWidth\r\n                  label=\"Full Name\"\r\n                  value={newUserData.name}\r\n                  onChange={(e) => setNewUserData(prev => ({ ...prev, name: e.target.value }))}\r\n                  sx={{ mb: 2 }}\r\n                  size=\"small\"\r\n                  required\r\n                  autoFocus\r\n                />\r\n                <TextField\r\n                  fullWidth\r\n                  label=\"Email\"\r\n                  type=\"email\"\r\n                  value={newUserData.email}\r\n                  onChange={(e) => setNewUserData(prev => ({ ...prev, email: e.target.value }))}\r\n                  sx={{ mb: 2 }}\r\n                  size=\"small\"\r\n                  required\r\n                />\r\n                <TextField\r\n                  fullWidth\r\n                  label=\"Password\"\r\n                  type=\"password\"\r\n                  value={newUserData.password}\r\n                  onChange={(e) => setNewUserData(prev => ({ ...prev, password: e.target.value }))}\r\n                  sx={{ mb: 2 }}\r\n                  size=\"small\"\r\n                  required\r\n                  helperText=\"Minimum 6 characters\"\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={newUserData.role === 'admin'}\r\n                      onChange={(e) => setNewUserData(prev => ({ \r\n                        ...prev, \r\n                        role: e.target.checked ? 'admin' : 'user' \r\n                      }))}\r\n                      color=\"primary\"\r\n                    />\r\n                  }\r\n                  label={\r\n                    <Typography variant=\"body2\">\r\n                      Admin Access\r\n                    </Typography>\r\n                  }\r\n                />\r\n              </Box>\r\n            ) : dialogType === 'editUser' ? (\r\n              <Box sx={{ pt: 2 }}>\r\n                <TextField\r\n                  fullWidth\r\n                  label=\"Name\"\r\n                  value={editUserData.name}\r\n                  onChange={(e) => setEditUserData(prev => ({ ...prev, name: e.target.value }))}\r\n                  sx={{ mb: 2 }}\r\n                  size=\"small\"\r\n                />\r\n                <TextField\r\n                  fullWidth\r\n                  label=\"Email\"\r\n                  value={editUserData.email}\r\n                  onChange={(e) => setEditUserData(prev => ({ ...prev, email: e.target.value }))}\r\n                  sx={{ mb: 2 }}\r\n                  size=\"small\"\r\n                />\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={editUserData.isAdmin}\r\n                      onChange={(e) => setEditUserData(prev => ({ ...prev, isAdmin: e.target.checked }))}\r\n                      color=\"primary\"\r\n                    />\r\n                  }\r\n                  label={\r\n                    <Typography variant=\"body2\">\r\n                      Admin Access\r\n                    </Typography>\r\n                  }\r\n                />\r\n              </Box>\r\n            ) : (\r\n              <TextField\r\n                autoFocus\r\n                margin=\"dense\"\r\n                label=\"New Password\"\r\n                type=\"password\"\r\n                fullWidth\r\n                value={newPassword}\r\n                onChange={(e) => setNewPassword(e.target.value)}\r\n                size=\"small\"\r\n                sx={{ mt: 1 }}\r\n              />\r\n            )}\r\n          </DialogContent>\r\n          <DialogActions sx={{ px: 3, pb: 2 }}>\r\n            <Button \r\n              onClick={handleCloseDialog}\r\n              size=\"small\"\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              onClick={dialogType === 'createUser' ? handleCreateUserSubmit : \r\n                      dialogType === 'editUser' ? handleUpdateUser : handleChangePassword}\r\n              variant=\"contained\"\r\n              size=\"small\"\r\n              disabled={dialogType === 'createUser' && (!newUserData.name || !newUserData.email || !newUserData.password || newUserData.password.length < 6)}\r\n            >\r\n              {dialogType === 'createUser' ? 'Create User' :\r\n               dialogType === 'editUser' ? 'Update User' : 'Change Password'}\r\n            </Button>\r\n          </DialogActions>\r\n        </Dialog>\r\n\r\n        <Snackbar\r\n          open={snackbar.open}\r\n          autoHideDuration={4000}\r\n          onClose={handleSnackbarClose}\r\n          anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\r\n        >\r\n          <Alert\r\n            onClose={handleSnackbarClose}\r\n            severity={snackbar.severity}\r\n            variant=\"filled\"\r\n            sx={{ \r\n              width: '100%',\r\n              boxShadow: 2\r\n            }}\r\n          >\r\n            {snackbar.message}\r\n          </Alert>\r\n        </Snackbar>\r\n      </Container>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AdminPortal; ","import { databases } from '../appwrite';\r\nimport { Query, ID, Permission, Role } from 'appwrite';\r\n\r\nconst DATABASE_ID = process.env.REACT_APP_APPWRITE_DATABASE_ID || '69181c670024df0dd32b';\r\nconst GROUPS_COLLECTION_ID = process.env.REACT_APP_APPWRITE_COLLECTION_GROUPS || '6918f637002e49bd5482';\r\n\r\nexport async function listGroups(userId = null) {\r\n  try {\r\n    const queries = [];\r\n    // Filter by type='note' to distinguish from password groups\r\n    // Also include groups without type (for backward compatibility)\r\n    queries.push(Query.or([\r\n      Query.equal('type', 'note'),\r\n      Query.isNull('type')\r\n    ]));\r\n    if (userId) {\r\n      queries.push(Query.equal('ownerId', userId));\r\n    }\r\n    const res = await databases.listDocuments(DATABASE_ID, GROUPS_COLLECTION_ID, queries);\r\n    const groups = res.documents || [];\r\n    \r\n    // Enrich members with profile information\r\n    const PROFILES_COLLECTION_ID = process.env.REACT_APP_APPWRITE_COLLECTION_PROFILES || '6918f632002d42536ab2';\r\n    const enrichedGroups = await Promise.all(groups.map(async (group) => {\r\n      if (!group.members || !Array.isArray(group.members)) {\r\n        return { ...group, membersWithInfo: [] };\r\n      }\r\n      \r\n      // Parse member nicknames\r\n      let memberNicknames = {};\r\n      try {\r\n        memberNicknames = group.memberNicknames ? JSON.parse(group.memberNicknames) : {};\r\n      } catch (e) {\r\n        memberNicknames = {};\r\n      }\r\n      \r\n      // Fetch profiles for all member IDs\r\n      const memberProfiles = await Promise.all(\r\n        group.members.map(async (memberId) => {\r\n          try {\r\n            const profiles = await databases.listDocuments(\r\n              DATABASE_ID,\r\n              PROFILES_COLLECTION_ID,\r\n              [Query.equal('userId', memberId)]\r\n            );\r\n            \r\n            if (profiles.documents && profiles.documents.length > 0) {\r\n              const profile = profiles.documents[0];\r\n              return {\r\n                userId: memberId,\r\n                name: profile.name || profile.email || 'Unknown',\r\n                email: profile.email || '',\r\n                nickname: memberNicknames[memberId] || ''\r\n              };\r\n            }\r\n            return {\r\n              userId: memberId,\r\n              name: 'Unknown User',\r\n              email: '',\r\n              nickname: memberNicknames[memberId] || ''\r\n            };\r\n          } catch (err) {\r\n            console.warn(`Failed to fetch profile for ${memberId}:`, err);\r\n            return {\r\n              userId: memberId,\r\n              name: 'Unknown User',\r\n              email: '',\r\n              nickname: memberNicknames[memberId] || ''\r\n            };\r\n          }\r\n        })\r\n      );\r\n      \r\n      return { ...group, membersWithInfo: memberProfiles };\r\n    }));\r\n    \r\n    return enrichedGroups;\r\n  } catch (err) {\r\n    console.warn('Failed to fetch groups:', err);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function createGroup(userId, groupData) {\r\n  try {\r\n    const { name, description } = groupData;\r\n    if (!name) {\r\n      throw new Error('Group name is required');\r\n    }\r\n    \r\n    // Set document permissions: owner can read/write, all users can read\r\n    const permissions = [\r\n      Permission.read(Role.user(userId)), // Owner can read\r\n      Permission.update(Role.user(userId)), // Owner can update\r\n      Permission.delete(Role.user(userId)), // Owner can delete\r\n      Permission.read(Role.users()) // All authenticated users can read (for listing)\r\n    ];\r\n    \r\n    const document = await databases.createDocument(\r\n      DATABASE_ID,\r\n      GROUPS_COLLECTION_ID,\r\n      ID.unique(),\r\n      {\r\n        ownerId: userId,\r\n        name: name.trim(),\r\n        description: description || '',\r\n        members: [], // Start with empty members array\r\n        memberNicknames: '{}', // JSON string for member nicknames\r\n        type: 'note' // Distinguish from password groups\r\n      },\r\n      permissions\r\n    );\r\n    return document;\r\n  } catch (err) {\r\n    console.error('Failed to create group:', err);\r\n    throw err;\r\n  }\r\n}\r\n\r\nexport async function addMemberToGroup(groupId, userEmail, nickname = '') {\r\n  try {\r\n    // First, get the group\r\n    const group = await databases.getDocument(DATABASE_ID, GROUPS_COLLECTION_ID, groupId);\r\n    \r\n    // Find user by email from profiles\r\n    const PROFILES_COLLECTION_ID = process.env.REACT_APP_APPWRITE_COLLECTION_PROFILES || '6918f632002d42536ab2';\r\n    const profiles = await databases.listDocuments(\r\n      DATABASE_ID,\r\n      PROFILES_COLLECTION_ID,\r\n      [Query.equal('email', userEmail.toLowerCase())]\r\n    );\r\n    \r\n    if (!profiles.documents || profiles.documents.length === 0) {\r\n      throw new Error('User not found with that email');\r\n    }\r\n    \r\n    const userProfile = profiles.documents[0];\r\n    const userId = userProfile.userId;\r\n    \r\n    // Get current members (array of user IDs) and nicknames (JSON object)\r\n    const currentMembers = group.members || [];\r\n    let memberNicknames = {};\r\n    try {\r\n      memberNicknames = group.memberNicknames ? JSON.parse(group.memberNicknames) : {};\r\n    } catch (e) {\r\n      memberNicknames = {};\r\n    }\r\n    \r\n    // Check if user is already a member\r\n    if (currentMembers.includes(userId)) {\r\n      throw new Error('User is already a member of this group');\r\n    }\r\n    \r\n    // Add user ID to members array and nickname to nicknames object\r\n    const updatedMembers = [...currentMembers, userId];\r\n    if (nickname.trim()) {\r\n      memberNicknames[userId] = nickname.trim();\r\n    }\r\n    \r\n    // Update the group with proper permissions\r\n    const permissions = [\r\n      Permission.read(Role.user(group.ownerId)), // Owner can read\r\n      Permission.update(Role.user(group.ownerId)), // Owner can update\r\n      Permission.delete(Role.user(group.ownerId)), // Owner can delete\r\n      Permission.read(Role.users()) // All authenticated users can read\r\n    ];\r\n    \r\n    return await databases.updateDocument(\r\n      DATABASE_ID,\r\n      GROUPS_COLLECTION_ID,\r\n      groupId,\r\n      {\r\n        members: updatedMembers,\r\n        memberNicknames: JSON.stringify(memberNicknames)\r\n      },\r\n      permissions\r\n    );\r\n  } catch (err) {\r\n    console.error('Failed to add member:', err);\r\n    throw err;\r\n  }\r\n}\r\n\r\nexport async function removeMemberFromGroup(groupId, userId) {\r\n  try {\r\n    const group = await databases.getDocument(DATABASE_ID, GROUPS_COLLECTION_ID, groupId);\r\n    const currentMembers = group.members || [];\r\n    const updatedMembers = currentMembers.filter(m => m !== userId);\r\n    \r\n    // Remove nickname if exists\r\n    let memberNicknames = {};\r\n    try {\r\n      memberNicknames = group.memberNicknames ? JSON.parse(group.memberNicknames) : {};\r\n    } catch (e) {\r\n      memberNicknames = {};\r\n    }\r\n    delete memberNicknames[userId];\r\n    \r\n    const permissions = [\r\n      Permission.read(Role.user(group.ownerId)),\r\n      Permission.update(Role.user(group.ownerId)),\r\n      Permission.delete(Role.user(group.ownerId)),\r\n      Permission.read(Role.users())\r\n    ];\r\n    \r\n    return await databases.updateDocument(\r\n      DATABASE_ID,\r\n      GROUPS_COLLECTION_ID,\r\n      groupId,\r\n      {\r\n        members: updatedMembers,\r\n        memberNicknames: JSON.stringify(memberNicknames)\r\n      },\r\n      permissions\r\n    );\r\n  } catch (err) {\r\n    console.error('Failed to remove member:', err);\r\n    throw err;\r\n  }\r\n}\r\n\r\nexport async function deleteGroup(documentId) {\r\n  try {\r\n    return await databases.deleteDocument(DATABASE_ID, GROUPS_COLLECTION_ID, documentId);\r\n  } catch (err) {\r\n    console.error('Failed to delete group:', err);\r\n    throw err;\r\n  }\r\n}\r\n\r\nexport default { listGroups, createGroup, addMemberToGroup, removeMemberFromGroup, deleteGroup };\r\n"],"names":["DATABASE_ID","process","PASSWORDS_COLLECTION_ID","ENCRYPTION_KEY","createPassword","async","userId","entry","console","log","collectionId","title","Error","payload","ownerId","text","password","encryptedPassword","CryptoJS","encrypt","toString","result","databases","createDocument","ID","unique","$id","error","message","code","type","response","listPasswords","arguments","length","undefined","queries","Query","equal","entries","listDocuments","documents","PROFILES_COLLECTION_ID","Promise","all","map","profiles","profile","owner","name","email","err","warn","getDecryptedPassword","encrypted","cipher","decrypt","Utf8","e","deletePassword","documentId","deleteDocument","LOGS_COLLECTION_ID","REACT_APP_APPWRITE_COLLECTION_LOGS","listLogs","_error$message","includes","AdminPortal","_user$profile","user","useAuth","activeTab","setActiveTab","useState","users","setUsers","passwordEntries","setPasswordEntries","groups","setGroups","setError","success","setSuccess","selectedUser","setSelectedUser","selectedEntry","setSelectedEntry","newPassword","setNewPassword","showPassword","setShowPassword","decryptedPasswords","setDecryptedPasswords","dialogOpen","setDialogOpen","dialogType","setDialogType","editUserData","setEditUserData","isAdmin","newUserData","setNewUserData","role","loginLogs","setLoginLogs","snackbar","setSnackbar","open","severity","fetchData","useCallback","fetchUsers","fetchPasswordEntries","fetchGroups","fetchLoginLogs","useEffect","docs","profilesService","mapped","Array","isArray","doc","_id","hasProfile","showSnackbar","res","passwordsService","d","username","password_encrypted","group","groupId","groupsService","members","logsService","userName","userEmail","timestamp","$createdAt","ipAddress","handleChangePassword","isAdminUser","instructions","alert","_err$response2","_err$response2$data","data","handleCloseDialog","handleSnackbarClose","_jsxs","Container","children","_jsx","Typography","variant","sx","mt","mb","_Fragment","AppBar","position","color","elevation","Toolbar","IconButton","edge","onClick","handleBack","window","history","back","mr","ArrowBackIcon","component","flexGrow","maxWidth","Box","display","flexDirection","gap","py","fontWeight","Alert","alignItems","borderBottom","borderColor","justifyContent","Tabs","value","onChange","newValue","textTransform","fontSize","minHeight","Tab","label","Button","startIcon","AddIcon","handleCreateUser","ml","TableContainer","Paper","boxShadow","borderRadius","overflow","Table","size","TableHead","TableRow","TableCell","TableBody","colSpan","align","fontFamily","minWidth","Chip","charAt","toUpperCase","slice","height","handlePasswordChange","KeyIcon","handleEditUser","EditIcon","confirm","handleDeleteUser","DeleteIcon","_entry$owner","_entry$group","plain","prev","VisibilityOffIcon","VisibilityIcon","entryId","handleDeletePasswordEntry","_group$owner","flexWrap","member","handleDeleteGroup","Date","toLocaleString","Dialog","onClose","fullWidth","DialogTitle","DialogContent","pt","p","bgcolor","border","TextField","target","margin","autoFocus","helperText","DialogActions","disabled","PaperProps","pb","required","FormControlLabel","control","Switch","checked","px","setTimeout","_err$response","_err$response$data","newRole","Snackbar","autoHideDuration","anchorOrigin","vertical","horizontal","width","GROUPS_COLLECTION_ID","listGroups","push","or","isNull","membersWithInfo","memberNicknames","JSON","parse","memberProfiles","memberId","nickname","createGroup","groupData","description","permissions","Permission","read","Role","update","delete","trim","addMemberToGroup","getDocument","toLowerCase","currentMembers","updatedMembers","updateDocument","stringify","removeMemberFromGroup","filter","m","deleteGroup"],"sourceRoot":""}