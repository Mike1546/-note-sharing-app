(self.webpackChunknote_sharing_app_client=self.webpackChunknote_sharing_app_client||[]).push([[638],{1963:(e,s,r)=>{"use strict";r.d(s,{Ay:()=>c});var n=r(8561),o=r.n(n),a=r(5404),i=r(5460);const t="69181c670024df0dd32b",l="6918f63900228f33e93c",d="AumLB6URqqyU5pUr3MNCTsEDlBIeQUaCOVBIyYYBl/U=";const c={createPassword:async function(e,s){if(console.log("[Password Manager] Creating password entry",{userId:e,entry:s,collectionId:l}),!s.title)throw new Error("Title is required");const r={...s,ownerId:e};var n;if(s.password&&(r.encryptedPassword=(n=s.password,o().AES.encrypt(n,d).toString()),delete r.password),!r.encryptedPassword)throw new Error("Password is required");try{const e=await a.LL.createDocument(t,l,i.ID.unique(),r);return console.log("[Password Manager] Password created successfully",e.$id),e}catch(c){throw console.error("[Password Manager] Create error:",c),console.error("[Password Manager] Error details:",{message:c.message,code:c.code,type:c.type,response:c.response}),c}},listPasswords:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const s=e?[i.XK.equal("ownerId",e)]:[],r=(await a.LL.listDocuments(t,l,s)).documents||[],n="6918f632002d42536ab2";return await Promise.all(r.map((async e=>{if(!e.ownerId)return e;try{const s=await a.LL.listDocuments(t,n,[i.XK.equal("userId",e.ownerId)]);if(s.documents&&s.documents.length>0){const r=s.documents[0];return{...e,owner:{name:r.name||r.email||"Unknown",email:r.email||""}}}return{...e,owner:{name:"Unknown User",email:""}}}catch(s){return console.warn(`Failed to fetch profile for owner ${e.ownerId}:`,s),{...e,owner:{name:"Unknown User",email:""}}}})))}catch(s){return console.warn("Failed to fetch passwords:",s),[]}},getDecryptedPassword:async function(e){try{return s=e,o().AES.decrypt(s,d).toString(o().enc.Utf8)}catch(r){throw console.error("Decrypt error",r),r}var s},deletePassword:async function(e){return a.LL.deleteDocument(t,l,e)}}},6080:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>K});var n=r(5043),o=r(9252),a=r(5865),i=r(2314),t=r(5263),l=r(7392),d=r(6446),c=r(547),m=r(4912),u=r(4056),h=r(3438),A=r(9650),x=r(3336),p=r(1806),w=r(4882),y=r(8076),f=r(39),g=r(3460),j=r(3845),b=r(35),v=r(6600),P=r(5316),_=r(7784),C=r(9347),E=r(4605),I=r(7843),W=r(6520),S=r(7332),U=r(141),T=r(9049),k=r(3560),L=r(3768),N=r(3559),R=r(3632),D=r(5016),O=r(1931),F=r(1963),X=r(6717),z=r(5404);const $={NODE_ENV:"production",PUBLIC_URL:"/-note-sharing-app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"https://note-sharing-app.onrender.com",REACT_APP_APPWRITE_COLLECTION_GROUPS:"6918f637002e49bd5482",REACT_APP_APPWRITE_COLLECTION_NOTES:"6918f63400264192256d",REACT_APP_APPWRITE_COLLECTION_PASSWORDS:"6918f63900228f33e93c",REACT_APP_APPWRITE_COLLECTION_PROFILES:"6918f632002d42536ab2",REACT_APP_APPWRITE_DATABASE_ID:"69181c670024df0dd32b",REACT_APP_APPWRITE_ENDPOINT:"https://nyc.cloud.appwrite.io/v1",REACT_APP_APPWRITE_PROJECT:"691815b8003ae6a0e161",REACT_APP_ENCRYPTION_KEY:"AumLB6URqqyU5pUr3MNCTsEDlBIeQUaCOVBIyYYBl/U="}.REACT_APP_APPWRITE_COLLECTION_LOGS||"691fc47f00242f9c53a4";const q={listLogs:async function(){try{return(await z.LL.listDocuments("69181c670024df0dd32b",$)).documents||[]}catch(s){var e;return 404===s.code||null!==(e=s.message)&&void 0!==e&&e.includes("not be found")?(console.warn("[Logs] Collection not found, returning empty array"),[]):(console.error("[Logs] Error fetching logs:",s.message||s),[])}}};var M=r(579);const K=()=>{var e;const{user:s}=(0,D.A)(),[r,z]=(0,n.useState)(0),[$,K]=(0,n.useState)([]),[G,B]=(0,n.useState)([]),[Y,J]=(0,n.useState)([]),[H,V]=(0,n.useState)(""),[Q,Z]=(0,n.useState)(""),[ee,se]=(0,n.useState)(null),[re,ne]=(0,n.useState)(null),[oe,ae]=(0,n.useState)(""),[ie,te]=(0,n.useState)({}),[le,de]=(0,n.useState)({}),[ce,me]=(0,n.useState)(!1),[ue,he]=(0,n.useState)(""),[Ae,xe]=(0,n.useState)({name:"",email:"",isAdmin:!1}),[pe,we]=(0,n.useState)({name:"",email:"",password:"",role:"user"}),[ye,fe]=(0,n.useState)([]),[ge,je]=(0,n.useState)({open:!1,message:"",severity:"success"}),be=(0,n.useCallback)((async()=>{try{switch(r){case 0:await ve();break;case 1:await Pe();break;case 2:await _e();break;case 3:await Ce();break;default:console.log("Unknown tab selected")}}catch(e){V("Failed to fetch data")}}),[r]);(0,n.useEffect)((()=>{be()}),[be]);const ve=async()=>{try{const e=await O.Ay.listProfiles(),s=(Array.isArray(e)?e:e.documents||[]).map((e=>({_id:e.$id,userId:e.userId,name:e.name||"",email:e.email||"",role:e.role||"user",hasProfile:!0})));K(s),0===s.length?(console.warn("[AdminPortal] No users found in profiles collection"),console.warn("[AdminPortal] Some users may exist in Appwrite but not have profiles"),console.warn("[AdminPortal] Run: node scripts/syncUsersToProfiles.js to sync all users")):console.log(`[AdminPortal] Loaded ${s.length} users with profiles`)}catch(H){console.error("Error fetching users:",H),We("Error fetching users: "+(H.message||"Unknown error"),"error")}},Pe=async()=>{try{const e=await F.Ay.listPasswords(null),s=(Array.isArray(e)?e:e.documents||[]).map((e=>({_id:e.$id||e._id,title:e.title,username:e.username,password_encrypted:e.encryptedPassword||e.password_encrypted,owner:e.owner||(e.ownerId?{name:e.ownerId,email:""}:null),group:e.group||e.groupId||null,...e})));B(s)}catch(H){console.error("Error fetching password entries:",H),We("Error fetching password entries: "+(H.message||"Unknown error"),"error")}},_e=async()=>{try{const e=await X.Ay.listGroups(),s=(Array.isArray(e)?e:e.documents||[]).map((e=>({_id:e.$id||e._id,name:e.name,owner:e.owner||e.ownerId||null,members:e.members||[]})));J(s)}catch(H){console.error("Error fetching groups:",H),We("Error fetching groups: "+(H.message||"Unknown error"),"error")}},Ce=async()=>{try{const e=await q.listLogs(),s=(Array.isArray(e)?e:e.documents||[]).map((e=>({_id:e.$id||e._id,userName:e.userName||e.name||"",userEmail:e.userEmail||e.email||"",timestamp:e.timestamp||e.$createdAt,ipAddress:e.ipAddress||"N/A",success:void 0===e.success||e.success})));fe(s),0===s.length&&console.log("[AdminPortal] No login logs found (collection may not exist)")}catch(H){var e;console.error("Error fetching login logs:",H),null!==(e=H.message)&&void 0!==e&&e.includes("not be found")||404===H.code?fe([]):We("Error fetching login logs: "+(H.message||"Unknown error"),"error")}},Ee=async()=>{try{if(!oe||oe.length<6)return void V("Password must be at least 6 characters long");const e="admin"===((null===ee||void 0===ee?void 0:ee.role)||"user"),s=`To reset password for ${null===ee||void 0===ee?void 0:ee.email}${e?" (Admin)":""}:\n\nRun this command:\nnode scripts/resetUserPassword.js "${null===ee||void 0===ee?void 0:ee.email}" "${oe}"\n\nNote: As an admin, you can reset any user's password, including other admins.\nMake sure APPWRITE_API_KEY is set in your environment.`;alert(s),We("See alert for password reset instructions","info"),me(!1),ae(""),he("")}catch(r){var e,s;V((null===(e=r.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to change password")}},Ie=()=>{me(!1),ae(""),se(null),ne(null),xe({name:"",email:"",isAdmin:!1}),we({name:"",email:"",password:"",role:"user"})},We=function(e){je({open:!0,message:e,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"})},Se=()=>{je({...ge,open:!1})},Ue=(null===s||void 0===s||null===(e=s.profile)||void 0===e?void 0:e.role)||"user";return"admin"!==Ue&&"developer"!==Ue?(0,M.jsxs)(o.A,{children:[(0,M.jsx)(a.A,{variant:"h4",sx:{mt:4,mb:2},children:"Access Denied"}),(0,M.jsx)(a.A,{children:"You do not have permission to access the admin portal."})]}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(i.A,{position:"static",color:"transparent",elevation:0,children:(0,M.jsxs)(t.A,{children:[(0,M.jsx)(l.A,{edge:"start",color:"inherit",onClick:()=>{window.history.back()},sx:{mr:2},children:(0,M.jsx)(S.A,{})}),(0,M.jsx)(a.A,{variant:"h6",component:"div",sx:{flexGrow:1},children:"Admin Portal"})]})}),(0,M.jsxs)(o.A,{maxWidth:"xl",children:[(0,M.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2,py:4},children:[(0,M.jsx)(a.A,{variant:"h4",sx:{fontWeight:"medium",color:"primary.main",mb:1},children:"Admin Portal"}),H&&(0,M.jsx)(c.A,{severity:"error",variant:"outlined",sx:{"& .MuiAlert-message":{display:"flex",alignItems:"center"}},children:H}),Q&&(0,M.jsx)(c.A,{severity:"success",variant:"outlined",sx:{"& .MuiAlert-message":{display:"flex",alignItems:"center"}},children:Q}),(0,M.jsx)(d.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,M.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,M.jsxs)(m.A,{value:r,onChange:(e,s)=>z(s),sx:{"& .MuiTab-root":{textTransform:"none",fontSize:"0.95rem",minHeight:48,py:0}},children:[(0,M.jsx)(u.A,{label:"Users"}),(0,M.jsx)(u.A,{label:"Password Entries"}),(0,M.jsx)(u.A,{label:"Groups"}),(0,M.jsx)(u.A,{label:"Login Logs"})]}),0===r&&(0,M.jsx)(h.A,{variant:"contained",color:"primary",startIcon:(0,M.jsx)(U.A,{}),onClick:()=>{we({name:"",email:"",password:"",role:"user"}),he("createUser"),me(!0)},sx:{ml:2},children:"Create User"})]})}),(0,M.jsx)(A.A,{component:x.A,sx:{boxShadow:2,borderRadius:1,overflow:"hidden"},children:(0,M.jsxs)(p.A,{size:"small",children:[0===r&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(w.A,{children:(0,M.jsxs)(y.A,{children:[(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Name"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Email"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Role"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Actions"})]})}),(0,M.jsx)(g.A,{children:0===$.length?(0,M.jsx)(y.A,{children:(0,M.jsxs)(f.A,{colSpan:4,align:"center",sx:{py:4},children:[(0,M.jsx)(a.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"No users found in profiles collection"}),(0,M.jsx)(a.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Some users may exist in Appwrite but don't have profiles yet."}),(0,M.jsx)(a.A,{variant:"caption",color:"text.secondary",sx:{display:"block",fontFamily:"monospace",mb:2},children:"Run: node scripts/syncUsersToProfiles.js"}),(0,M.jsx)(h.A,{variant:"outlined",size:"small",onClick:()=>{alert("To sync all Appwrite users to profiles:\n\nRun this command:\nnode scripts/syncUsersToProfiles.js\n\nMake sure APPWRITE_API_KEY is set in your environment.")},children:"Show Sync Instructions"})]})}):$.map((e=>(0,M.jsxs)(y.A,{children:[(0,M.jsx)(f.A,{sx:{minWidth:120},children:e.name||"N/A"}),(0,M.jsx)(f.A,{sx:{minWidth:180},children:e.email||"N/A"}),(0,M.jsx)(f.A,{sx:{minWidth:100},children:(0,M.jsx)(j.A,{label:e.role?e.role.charAt(0).toUpperCase()+e.role.slice(1):"User",color:"developer"===e.role?"secondary":"admin"===e.role?"primary":"default",size:"small",sx:{fontSize:"0.75rem",height:"24px"}})}),(0,M.jsxs)(f.A,{children:[(0,M.jsx)(l.A,{size:"small",onClick:()=>(e=>{se(e),he("changePassword"),me(!0)})(e),color:"primary",title:`Reset password for ${e.email}${"admin"===e.role?" (Admin)":""}. Admins can reset any password, including other admins.`,children:(0,M.jsx)(T.A,{})}),(0,M.jsx)(l.A,{size:"small",onClick:()=>(e=>{se(e),xe({name:e.name,email:e.email,isAdmin:"admin"===e.role}),he("editUser"),me(!0)})(e),color:"primary",title:"Edit user",children:(0,M.jsx)(k.A,{})}),(0,M.jsx)(l.A,{size:"small",onClick:()=>(async()=>{if(window.confirm("Are you sure? This will delete all user data including passwords and groups."))try{We("To delete a user, use the Appwrite console or run a server-side admin script.","info")}catch(e){V("Failed to initiate delete")}})(e._id),color:"error",title:"Delete user",children:(0,M.jsx)(L.A,{})})]})]},e._id||e.userId)))})]}),1===r&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(w.A,{children:(0,M.jsxs)(y.A,{children:[(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Title"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Username"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Password"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Owner"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Group"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Actions"})]})}),(0,M.jsx)(g.A,{children:G.map((e=>{var s,r;return(0,M.jsxs)(y.A,{children:[(0,M.jsx)(f.A,{sx:{minWidth:150},children:e.title}),(0,M.jsx)(f.A,{sx:{minWidth:120},children:e.username}),(0,M.jsx)(f.A,{sx:{minWidth:150},children:(0,M.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,M.jsx)(a.A,{sx:{fontFamily:"monospace"},children:ie[e._id]?le[e._id]||"Decrypting...":"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"}),(0,M.jsx)(l.A,{size:"small",onClick:async()=>{if(!!!ie[e._id]&&!le[e._id]&&e.password_encrypted)try{const s=await F.Ay.getDecryptedPassword(e.password_encrypted);de((r=>({...r,[e._id]:s})))}catch(s){de((s=>({...s,[e._id]:"Error"})))}te((s=>({...s,[e._id]:!s[e._id]})))},children:ie[e._id]?(0,M.jsx)(N.A,{fontSize:"small"}):(0,M.jsx)(R.A,{fontSize:"small"})})]})}),(0,M.jsx)(f.A,{sx:{minWidth:120},children:(null===(s=e.owner)||void 0===s?void 0:s.name)||("string"===typeof e.owner?e.owner:"Unknown")}),(0,M.jsx)(f.A,{sx:{minWidth:120},children:(null===(r=e.group)||void 0===r?void 0:r.name)||"-"}),(0,M.jsx)(f.A,{children:(0,M.jsx)(l.A,{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this password entry?"))try{await F.Ay.deletePassword(e),Z("Password entry deleted successfully"),Pe()}catch(s){V("Failed to delete password entry")}})(e._id),size:"small",color:"error",children:(0,M.jsx)(L.A,{fontSize:"small"})})})]},e._id)}))})]}),2===r&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(w.A,{children:(0,M.jsxs)(y.A,{children:[(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Name"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Owner"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Members"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Actions"})]})}),(0,M.jsx)(g.A,{children:Y.map((e=>{var s;return(0,M.jsxs)(y.A,{children:[(0,M.jsx)(f.A,{sx:{minWidth:150},children:e.name}),(0,M.jsx)(f.A,{sx:{minWidth:120},children:null===(s=e.owner)||void 0===s?void 0:s.name}),(0,M.jsx)(f.A,{sx:{minWidth:200},children:(0,M.jsx)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.members.map((e=>(0,M.jsx)(j.A,{label:`${e.user.name} (${e.role})`,size:"small",color:"admin"===e.role?"primary":"default",sx:{fontSize:"0.75rem",height:"24px"}},e.user._id)))})}),(0,M.jsx)(f.A,{children:(0,M.jsx)(l.A,{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this group?"))try{await X.Ay.deleteGroup(e),Z("Group deleted successfully"),_e()}catch(s){V("Failed to delete group")}})(e._id),size:"small",color:"error",children:(0,M.jsx)(L.A,{fontSize:"small"})})})]},e._id)}))})]}),3===r&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(w.A,{children:(0,M.jsxs)(y.A,{children:[(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"User"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Email"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Timestamp"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"IP Address"}),(0,M.jsx)(f.A,{sx:{fontWeight:"bold"},children:"Status"})]})}),(0,M.jsx)(g.A,{children:ye.map((e=>(0,M.jsxs)(y.A,{children:[(0,M.jsx)(f.A,{sx:{minWidth:120},children:e.userName}),(0,M.jsx)(f.A,{sx:{minWidth:180},children:e.userEmail}),(0,M.jsx)(f.A,{sx:{minWidth:160,fontFamily:"monospace"},children:new Date(e.timestamp).toLocaleString()}),(0,M.jsx)(f.A,{sx:{minWidth:120,fontFamily:"monospace"},children:e.ipAddress}),(0,M.jsx)(f.A,{sx:{minWidth:100},children:(0,M.jsx)(j.A,{label:e.success?"Success":"Failed",color:e.success?"success":"error",size:"small",sx:{fontSize:"0.75rem",height:"24px",minWidth:"80px"}})})]},e._id)))})]})]})})]}),(0,M.jsxs)(b.A,{open:ce&&"changePassword"===ue,onClose:Ie,maxWidth:"sm",fullWidth:!0,children:[(0,M.jsxs)(v.A,{children:["Change Password for ",null===ee||void 0===ee?void 0:ee.name,"admin"===(null===ee||void 0===ee?void 0:ee.role)&&(0,M.jsx)(j.A,{label:"Admin",color:"primary",size:"small",sx:{ml:1,fontSize:"0.7rem",height:"20px"}})]}),(0,M.jsx)(P.A,{children:(0,M.jsxs)(d.A,{sx:{pt:2},children:["admin"===(null===ee||void 0===ee?void 0:ee.role)&&(0,M.jsxs)(d.A,{sx:{mb:2,p:1.5,bgcolor:"info.light",borderRadius:1,border:"1px solid",borderColor:"info.main"},children:[(0,M.jsx)(a.A,{variant:"body2",sx:{fontWeight:"medium",mb:.5},children:"Admin Password Reset"}),(0,M.jsx)(a.A,{variant:"caption",color:"text.secondary",children:"As an admin, you can reset any user's password, including other admins. Only admins have this privilege."})]}),(0,M.jsx)(_.A,{fullWidth:!0,type:"password",label:"New Password",value:oe,onChange:e=>ae(e.target.value),margin:"dense",autoFocus:!0,error:!!H&&H.includes("Password"),helperText:H&&H.includes("Password")?H:"Minimum 6 characters"})]})}),(0,M.jsxs)(C.A,{children:[(0,M.jsx)(h.A,{onClick:Ie,children:"Cancel"}),(0,M.jsx)(h.A,{onClick:Ee,variant:"contained",disabled:!oe||oe.length<6,children:"Change Password"})]})]}),(0,M.jsxs)(b.A,{open:ce,onClose:Ie,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:1,boxShadow:3}},children:[(0,M.jsx)(v.A,{sx:{pb:1},children:"createUser"===ue?"Create New User":"editUser"===ue?"Edit User":"Change Password"}),(0,M.jsx)(P.A,{sx:{pb:2},children:"createUser"===ue?(0,M.jsxs)(d.A,{sx:{pt:2},children:[(0,M.jsx)(_.A,{fullWidth:!0,label:"Full Name",value:pe.name,onChange:e=>we((s=>({...s,name:e.target.value}))),sx:{mb:2},size:"small",required:!0,autoFocus:!0}),(0,M.jsx)(_.A,{fullWidth:!0,label:"Email",type:"email",value:pe.email,onChange:e=>we((s=>({...s,email:e.target.value}))),sx:{mb:2},size:"small",required:!0}),(0,M.jsx)(_.A,{fullWidth:!0,label:"Password",type:"password",value:pe.password,onChange:e=>we((s=>({...s,password:e.target.value}))),sx:{mb:2},size:"small",required:!0,helperText:"Minimum 6 characters"}),(0,M.jsx)(E.A,{control:(0,M.jsx)(I.A,{checked:"admin"===pe.role,onChange:e=>we((s=>({...s,role:e.target.checked?"admin":"user"}))),color:"primary"}),label:(0,M.jsx)(a.A,{variant:"body2",children:"Admin Access"})})]}):"editUser"===ue?(0,M.jsxs)(d.A,{sx:{pt:2},children:[(0,M.jsx)(_.A,{fullWidth:!0,label:"Name",value:Ae.name,onChange:e=>xe((s=>({...s,name:e.target.value}))),sx:{mb:2},size:"small"}),(0,M.jsx)(_.A,{fullWidth:!0,label:"Email",value:Ae.email,onChange:e=>xe((s=>({...s,email:e.target.value}))),sx:{mb:2},size:"small"}),(0,M.jsx)(E.A,{control:(0,M.jsx)(I.A,{checked:Ae.isAdmin,onChange:e=>xe((s=>({...s,isAdmin:e.target.checked}))),color:"primary"}),label:(0,M.jsx)(a.A,{variant:"body2",children:"Admin Access"})})]}):(0,M.jsx)(_.A,{autoFocus:!0,margin:"dense",label:"New Password",type:"password",fullWidth:!0,value:oe,onChange:e=>ae(e.target.value),size:"small",sx:{mt:1}})}),(0,M.jsxs)(C.A,{sx:{px:3,pb:2},children:[(0,M.jsx)(h.A,{onClick:Ie,size:"small",children:"Cancel"}),(0,M.jsx)(h.A,{onClick:"createUser"===ue?async()=>{try{if(!pe.name||!pe.email||!pe.password)return void V("All fields are required");if(pe.password.length<6)return void V("Password must be at least 6 characters long");const e=`To create user "${pe.email}":\n\nRun this command:\nnode scripts/createUser.js "${pe.name}" "${pe.email}" "${pe.password}" "${pe.role}"\n\nMake sure APPWRITE_API_KEY is set in your environment.`;alert(e),We("See alert for user creation instructions","info"),me(!1),we({name:"",email:"",password:"",role:"user"}),setTimeout((()=>{ve()}),2e3)}catch(r){var e,s;V((null===(e=r.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to create user")}}:"editUser"===ue?async()=>{try{if(ee._id){const e=Ae.isAdmin?"admin":"user";await O.Ay.updateProfileRole(ee._id,e),Z("User role updated successfully")}me(!1),ve()}catch(e){V("Failed to update user")}}:Ee,variant:"contained",size:"small",disabled:"createUser"===ue&&(!pe.name||!pe.email||!pe.password||pe.password.length<6),children:"createUser"===ue?"Create User":"editUser"===ue?"Update User":"Change Password"})]})]}),(0,M.jsx)(W.A,{open:ge.open,autoHideDuration:4e3,onClose:Se,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,M.jsx)(c.A,{onClose:Se,severity:ge.severity,variant:"filled",sx:{width:"100%",boxShadow:2},children:ge.message})})]})]})}},6305:()=>{},6717:(e,s,r)=>{"use strict";r.d(s,{Ay:()=>t});var n=r(5404),o=r(5460);const a="69181c670024df0dd32b",i="6918f637002e49bd5482";const t={listGroups:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const s=[];s.push(o.XK.or([o.XK.equal("type","note"),o.XK.isNull("type")])),e&&s.push(o.XK.equal("ownerId",e));const r=(await n.LL.listDocuments(a,i,s)).documents||[],t="6918f632002d42536ab2";return await Promise.all(r.map((async e=>{if(!e.members||!Array.isArray(e.members))return{...e,membersWithInfo:[]};let s={};try{s=e.memberNicknames?JSON.parse(e.memberNicknames):{}}catch(i){s={}}const r=await Promise.all(e.members.map((async e=>{try{const r=await n.LL.listDocuments(a,t,[o.XK.equal("userId",e)]);if(r.documents&&r.documents.length>0){const n=r.documents[0];return{userId:e,name:n.name||n.email||"Unknown",email:n.email||"",nickname:s[e]||""}}return{userId:e,name:"Unknown User",email:"",nickname:s[e]||""}}catch(r){return console.warn(`Failed to fetch profile for ${e}:`,r),{userId:e,name:"Unknown User",email:"",nickname:s[e]||""}}})));return{...e,membersWithInfo:r}})))}catch(s){return console.warn("Failed to fetch groups:",s),[]}},createGroup:async function(e,s){try{const{name:r,description:t}=s;if(!r)throw new Error("Group name is required");const l=[o.aX.read(o.Xh.user(e)),o.aX.update(o.Xh.user(e)),o.aX.delete(o.Xh.user(e)),o.aX.read(o.Xh.users())];return await n.LL.createDocument(a,i,o.ID.unique(),{ownerId:e,name:r.trim(),description:t||"",members:[],memberNicknames:"{}",type:"note"},l)}catch(r){throw console.error("Failed to create group:",r),r}},addMemberToGroup:async function(e,s){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const l=await n.LL.getDocument(a,i,e),d="6918f632002d42536ab2",c=await n.LL.listDocuments(a,d,[o.XK.equal("email",s.toLowerCase())]);if(!c.documents||0===c.documents.length)throw new Error("User not found with that email");const m=c.documents[0].userId,u=l.members||[];let h={};try{h=l.memberNicknames?JSON.parse(l.memberNicknames):{}}catch(t){h={}}if(u.includes(m))throw new Error("User is already a member of this group");const A=[...u,m];r.trim()&&(h[m]=r.trim());const x=[o.aX.read(o.Xh.user(l.ownerId)),o.aX.update(o.Xh.user(l.ownerId)),o.aX.delete(o.Xh.user(l.ownerId)),o.aX.read(o.Xh.users())];return await n.LL.updateDocument(a,i,e,{members:A,memberNicknames:JSON.stringify(h)},x)}catch(l){throw console.error("Failed to add member:",l),l}},removeMemberFromGroup:async function(e,s){try{const t=await n.LL.getDocument(a,i,e),l=(t.members||[]).filter((e=>e!==s));let d={};try{d=t.memberNicknames?JSON.parse(t.memberNicknames):{}}catch(r){d={}}delete d[s];const c=[o.aX.read(o.Xh.user(t.ownerId)),o.aX.update(o.Xh.user(t.ownerId)),o.aX.delete(o.Xh.user(t.ownerId)),o.aX.read(o.Xh.users())];return await n.LL.updateDocument(a,i,e,{members:l,memberNicknames:JSON.stringify(d)},c)}catch(t){throw console.error("Failed to remove member:",t),t}},deleteGroup:async function(e){try{return await n.LL.deleteDocument(a,i,e)}catch(s){throw console.error("Failed to delete group:",s),s}}}}}]);
//# sourceMappingURL=638.8c169b57.chunk.js.map