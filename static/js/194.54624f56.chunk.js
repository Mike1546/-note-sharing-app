"use strict";(self.webpackChunknote_sharing_app_client=self.webpackChunknote_sharing_app_client||[]).push([[194],{1321:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(6213);const o=window.location.hostname.includes("100.127.255"),s="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,a=o?{NODE_ENV:"production",PUBLIC_URL:"/-note-sharing-app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"https://note-sharing-app.onrender.com",REACT_APP_APPWRITE_COLLECTION_GROUPS:"6918f637002e49bd5482",REACT_APP_APPWRITE_COLLECTION_NOTES:"6918f63400264192256d",REACT_APP_APPWRITE_COLLECTION_PASSWORDS:"6918f63900228f33e93c",REACT_APP_APPWRITE_COLLECTION_PROFILES:"6918f632002d42536ab2",REACT_APP_APPWRITE_DATABASE_ID:"69181c670024df0dd32b",REACT_APP_APPWRITE_ENDPOINT:"https://nyc.cloud.appwrite.io/v1",REACT_APP_APPWRITE_PROJECT:"691815b8003ae6a0e161",REACT_APP_ENCRYPTION_KEY:"AumLB6URqqyU5pUr3MNCTsEDlBIeQUaCOVBIyYYBl/U="}.REACT_APP_TWINGATE_API_URL:s?"http://localhost:5000":"https://note-sharing-app.onrender.com";console.log("API Base URL:",a);const i=r.A.create({baseURL:a,withCredentials:!0,headers:{"Content-Type":"application/json"}});i.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e))),i.interceptors.response.use((e=>e),(e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)}));const c=i},1344:(e,t,n)=>{n.d(t,{_i:()=>i,cq:()=>d,rK:()=>c});var r=n(6931),o=n(3248),s=n(7097),a=n(6717);const i=e=>(0,r.I)({queryKey:["groups",e],queryFn:async()=>(await a.Ay.listGroups(e)).map((e=>({_id:e.$id,name:e.name||"",description:e.description||"",members:e.members||[],membersWithInfo:e.membersWithInfo||[],memberNicknames:e.memberNicknames||{},ownerId:e.ownerId}))),enabled:!!e,staleTime:3e5}),c=()=>{const e=(0,o.jE)();return(0,s.n)({mutationFn:async e=>{let{userId:t,groupData:n}=e;return await a.Ay.createGroup(t,n)},onSuccess:(t,n)=>{e.invalidateQueries(["groups",n.userId])}})},d=()=>{const e=(0,o.jE)();return(0,s.n)({mutationFn:async e=>{let{groupId:t,userId:n}=e;return await a.Ay.deleteGroup(t)},onSuccess:(t,n)=>{e.invalidateQueries(["groups",n.userId])}})}},2423:(e,t,n)=>{n.d(t,{Ay:()=>i});var r=n(5404),o=n(5460);const s="69181c670024df0dd32b",a="6918f63400264192256d";const i={createNote:async function(e,t){const n=[o.aX.read(o.Xh.user(e)),o.aX.update(o.Xh.user(e)),o.aX.delete(o.Xh.user(e)),o.aX.write(o.Xh.user(e))];try{return await r.LL.createDocument(s,a,"unique()",{...t,ownerId:e},n)}catch(d){var i,c;const n=(null===d||void 0===d?void 0:d.message)||(null===d||void 0===d||null===(i=d.response)||void 0===i?void 0:i.message)||"",o=(null===d||void 0===d?void 0:d.code)||(null===d||void 0===d||null===(c=d.response)||void 0===c?void 0:c.code);if(String(n).toLowerCase().includes("permissions")||400===o)return r.LL.createDocument(s,a,"unique()",{...t,ownerId:e});throw d}},listNotes:async function(e){try{const t=(await r.LL.listDocuments(s,a,[o.XK.equal("ownerId",e)])).documents||[],n="6918f632002d42536ab2";return await Promise.all(t.map((async e=>{if(!e.ownerId)return e;try{const t=await r.LL.listDocuments(s,n,[o.XK.equal("userId",e.ownerId)]);if(t.documents&&t.documents.length>0){const n=t.documents[0];return{...e,owner:{name:n.name||n.email||"Unknown",email:n.email||""}}}return{...e,owner:{name:"Unknown User",email:""}}}catch(t){return console.warn(`Failed to fetch profile for owner ${e.ownerId}:`,t),{...e,owner:{name:"Unknown User",email:""}}}})))}catch(t){try{const t=await r.LL.listDocuments(s,a);return t.documents=(t.documents||[]).filter((t=>t.ownerId===e)),t}catch(n){throw t}}},updateNote:async function(e,t,n){return r.LL.updateDocument(s,a,e,n)},deleteNote:async function(e){return r.LL.deleteDocument(s,a,e)}}},6717:(e,t,n)=>{n.d(t,{Ay:()=>i});var r=n(5404),o=n(5460);const s="69181c670024df0dd32b",a="6918f637002e49bd5482";const i={listGroups:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=[];t.push(o.XK.or([o.XK.equal("type","note"),o.XK.isNull("type")])),e&&t.push(o.XK.equal("ownerId",e));const n=(await r.LL.listDocuments(s,a,t)).documents||[],i="6918f632002d42536ab2";return await Promise.all(n.map((async e=>{if(!e.members||!Array.isArray(e.members))return{...e,membersWithInfo:[]};let t={};try{t=e.memberNicknames?JSON.parse(e.memberNicknames):{}}catch(a){t={}}const n=await Promise.all(e.members.map((async e=>{try{const n=await r.LL.listDocuments(s,i,[o.XK.equal("userId",e)]);if(n.documents&&n.documents.length>0){const r=n.documents[0];return{userId:e,name:r.name||r.email||"Unknown",email:r.email||"",nickname:t[e]||""}}return{userId:e,name:"Unknown User",email:"",nickname:t[e]||""}}catch(n){return console.warn(`Failed to fetch profile for ${e}:`,n),{userId:e,name:"Unknown User",email:"",nickname:t[e]||""}}})));return{...e,membersWithInfo:n}})))}catch(t){return console.warn("Failed to fetch groups:",t),[]}},createGroup:async function(e,t){try{const{name:n,description:i}=t;if(!n)throw new Error("Group name is required");const c=[o.aX.read(o.Xh.user(e)),o.aX.update(o.Xh.user(e)),o.aX.delete(o.Xh.user(e)),o.aX.read(o.Xh.users())];return await r.LL.createDocument(s,a,o.ID.unique(),{ownerId:e,name:n.trim(),description:i||"",members:[],memberNicknames:"{}",type:"note"},c)}catch(n){throw console.error("Failed to create group:",n),n}},addMemberToGroup:async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const c=await r.LL.getDocument(s,a,e),d="6918f632002d42536ab2",l=await r.LL.listDocuments(s,d,[o.XK.equal("email",t.toLowerCase())]);if(!l.documents||0===l.documents.length)throw new Error("User not found with that email");const u=l.documents[0].userId,m=c.members||[];let p={};try{p=c.memberNicknames?JSON.parse(c.memberNicknames):{}}catch(i){p={}}if(m.includes(u))throw new Error("User is already a member of this group");const h=[...m,u];n.trim()&&(p[u]=n.trim());const g=[o.aX.read(o.Xh.user(c.ownerId)),o.aX.update(o.Xh.user(c.ownerId)),o.aX.delete(o.Xh.user(c.ownerId)),o.aX.read(o.Xh.users())];return await r.LL.updateDocument(s,a,e,{members:h,memberNicknames:JSON.stringify(p)},g)}catch(c){throw console.error("Failed to add member:",c),c}},removeMemberFromGroup:async function(e,t){try{const i=await r.LL.getDocument(s,a,e),c=(i.members||[]).filter((e=>e!==t));let d={};try{d=i.memberNicknames?JSON.parse(i.memberNicknames):{}}catch(n){d={}}delete d[t];const l=[o.aX.read(o.Xh.user(i.ownerId)),o.aX.update(o.Xh.user(i.ownerId)),o.aX.delete(o.Xh.user(i.ownerId)),o.aX.read(o.Xh.users())];return await r.LL.updateDocument(s,a,e,{members:c,memberNicknames:JSON.stringify(d)},l)}catch(i){throw console.error("Failed to remove member:",i),i}},deleteGroup:async function(e){try{return await r.LL.deleteDocument(s,a,e)}catch(t){throw console.error("Failed to delete group:",t),t}}}},7194:(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var r=n(5043),o=n(3216),s=n(5865),a=n(6446),i=n(547),c=n(7784),d=n(3193),l=n(9190),u=n(598),m=n(2143),p=n(8911),h=n(7392),g=n(3845),w=n(4605),A=n(7843),y=n(3438),v=n(35),f=n(6600),x=n(5316),I=n(9347),b=n(9275),k=n(5275),L=n(8606),P=n(141),E=n(1007),j=n(351),_=n(7141),C=n(2698),S=n(8446),N=n(1321),T=(n(6717),n(2423)),X=n(5016),R=n(1344),D=n(446),O=n.n(D),U=n(579);const W=()=>{const{id:e}=(0,o.g)(),t=(0,o.Zp)(),n=(0,o.zy)(),{user:D}=(0,X.A)(),W=new URLSearchParams(n.search).get("groupId"),[q,$]=(0,r.useState)({title:"",content:"",isLocked:!1,lockPasscode:"",isEncrypted:!1,tags:[],groupId:W||""}),[F,G]=(0,r.useState)(""),[K,Y]=(0,r.useState)(!0),{data:z=[]}=(0,R._i)(null===D||void 0===D?void 0:D.$id),[B,J]=(0,r.useState)(""),[M,H]=(0,r.useState)(!1),[Q,V]=(0,r.useState)(""),[Z,ee]=(0,r.useState)(""),[te,ne]=(0,r.useState)(!1),[re,oe]=(0,r.useState)(0),[se,ae]=(0,r.useState)(!1),ie=(0,r.useRef)(null),[ce,de]=(0,r.useState)(!1),[le,ue]=(0,r.useState)(null),[me,pe]=(0,r.useState)(!1),he=(0,r.useRef)(null);(0,r.useEffect)((()=>{e&&"new"!==e?ge():(Y(!1),ie.current={title:"",content:"",isLocked:!1,lockPasscode:"",isEncrypted:!1,tags:[],groupId:W||""})}),[e]);const ge=async function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=localStorage.getItem("token");if(!t)throw new Error("No authentication token found");const r={headers:{Authorization:`Bearer ${t}`}},o=(await N.A.get(`/api/notes/${e}/metadata`,r)).data;if(ne(o.isLocked),o.isLocked&&!n)return $({...o,content:"\ud83d\udd12 This note is locked. Enter passcode to view."}),H(!0),void Y(!1);let s=`/api/notes/${e}`;n&&(s+=`?passcode=${encodeURIComponent(n.trim())}`),console.log("Fetching note with URL:",s);const a=await N.A.get(s,r);if(a.data){const e=a.data;$(e),ie.current={title:e.title||"",content:e.content||"",isLocked:!!e.isLocked,lockPasscode:e.lockPasscode||"",isEncrypted:!!e.isEncrypted,tags:Array.isArray(e.tags)?e.tags:[],groupId:e.groupId||""},e.isLocked&&G(e.content),H(!1),oe(0),J("")}Y(!1)}catch(B){var r,o,s,a,i;if(console.error("Note fetch error:",null===(r=B.response)||void 0===r?void 0:r.status,null===(o=B.response)||void 0===o?void 0:o.data),401===(null===(s=B.response)||void 0===s?void 0:s.status))oe((e=>{const n=e+1;return n>=3?(J("Too many incorrect attempts. Returning to dashboard."),setTimeout((()=>t("/")),2e3)):J(`Invalid passcode. ${3-n} attempts remaining.`),n})),ee("");else J((null===(a=B.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.message)||"Error loading note");Y(!1)}},we=e=>{const{name:t,value:n}=e.target;$("groupId"===t?e=>({...e,[t]:n||null}):e=>({...e,[t]:n}))};(0,r.useEffect)((()=>{const t=ie.current;if(!t)return void de(!1);const n={title:q.title||"",content:q.content||"",isLocked:!!q.isLocked,lockPasscode:q.lockPasscode||"",isEncrypted:!!q.isEncrypted,tags:Array.isArray(q.tags)?q.tags:[],groupId:q.groupId||""},r=JSON.stringify(t)!==JSON.stringify(n);return de(r),window.__unsavedChanges=r,r&&e&&"new"!==e&&!te&&(he.current&&clearTimeout(he.current),he.current=setTimeout((async()=>{try{pe(!0);const t={title:q.title,content:q.content,isLocked:q.isLocked,lockPasscode:q.lockPasscode,tags:q.tags,isEncrypted:q.isEncrypted,groupId:q.groupId||null};null!==D&&void 0!==D&&D.$id&&(await T.Ay.updateNote(e,D.$id,t),ue(new Date),de(!1),window.__unsavedChanges=!1)}catch(t){console.error("Auto-save error:",t)}finally{pe(!1)}}),2e3)),()=>{he.current&&clearTimeout(he.current)}}),[q,e,te,null===D||void 0===D?void 0:D.$id]),(0,r.useEffect)((()=>{const e=e=>{ce&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)}),[ce]);const Ae=()=>{Q.trim()&&!q.tags.includes(Q.trim())&&($({...q,tags:[...q.tags,Q.trim()]}),V(""))};return K?(0,U.jsx)(s.A,{children:"Loading..."}):(0,U.jsxs)(a.A,{component:"form",onSubmit:async n=>{n.preventDefault();try{const n={title:q.title,content:q.content,isLocked:q.isLocked,lockPasscode:q.lockPasscode,tags:q.tags,isEncrypted:q.isEncrypted,groupId:q.groupId||null};if(null===D||void 0===D||!D.$id)throw new Error("Not authenticated");e&&"new"!==e?await T.Ay.updateNote(e,D.$id,n):await T.Ay.createNote(D.$id,n),t("/")}catch(B){var r,o;console.error("Error saving note:",B),J((null===B||void 0===B?void 0:B.message)||(null===B||void 0===B||null===(r=B.response)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.message)||"Error saving note")}},sx:{maxWidth:800,mx:"auto",p:3},children:[(0,U.jsxs)(C.A,{sx:{mb:3},children:[(0,U.jsxs)(S.A,{component:"button",variant:"body1",onClick:()=>t("/"),sx:{display:"flex",alignItems:"center",gap:.5,textDecoration:"none"},children:[(0,U.jsx)(b.A,{fontSize:"small"}),"Home"]}),(0,U.jsxs)(S.A,{component:"button",variant:"body1",onClick:()=>t("/"),sx:{display:"flex",alignItems:"center",gap:.5,textDecoration:"none"},children:[(0,U.jsx)(k.A,{fontSize:"small"}),"Notes"]}),(0,U.jsx)(s.A,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:"new"===e?"New Note":q.title||"Untitled"})]}),(me||le)&&(0,U.jsx)(a.A,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:me?(0,U.jsx)(s.A,{variant:"caption",color:"text.secondary",children:"Saving..."}):(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(L.A,{fontSize:"small",color:"success"}),(0,U.jsxs)(s.A,{variant:"caption",color:"text.secondary",children:["Saved ",le?O()(le).format("MMM D, YYYY [at] h:mm A"):"just now"]})]})}),B&&(0,U.jsx)(i.A,{severity:"error",sx:{mb:2},children:B}),(0,U.jsxs)(a.A,{sx:{mb:2},children:[(0,U.jsx)(c.A,{fullWidth:!0,label:"Title",name:"title",value:q.title,onChange:we,required:!0,variant:"outlined",sx:{mb:2},disabled:te&&!q.lockPasscode}),(0,U.jsx)(c.A,{fullWidth:!0,label:"Content",name:"content",value:q.content,onChange:we,required:!0,multiline:!0,rows:12,variant:"outlined",sx:{mb:2},disabled:te&&!q.lockPasscode}),(0,U.jsxs)(d.A,{fullWidth:!0,sx:{mb:2},children:[(0,U.jsx)(l.A,{children:"Group"}),(0,U.jsxs)(u.A,{name:"groupId",value:q.groupId||"",onChange:we,label:"Group",children:[(0,U.jsx)(m.A,{value:"",children:(0,U.jsx)("em",{children:"No Group"})}),Array.isArray(z)&&z.map((e=>(0,U.jsxs)(m.A,{value:e._id||e.$id,children:[e.name,e.description&&(0,U.jsxs)(s.A,{variant:"caption",color:"text.secondary",sx:{ml:1},children:["- ",e.description]})]},e._id||e.$id)))]})]})]}),(0,U.jsxs)(a.A,{sx:{mb:2},children:[(0,U.jsx)(s.A,{variant:"subtitle2",sx:{mb:1,fontWeight:"medium"},children:"Tags"}),(0,U.jsxs)(p.A,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[(0,U.jsx)(c.A,{label:"Add Tag",value:Q,onChange:e=>V(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),Ae())},size:"small",placeholder:"Type and press Enter",sx:{flexGrow:1}}),(0,U.jsx)(h.A,{onClick:Ae,size:"small",color:"primary",disabled:!Q.trim(),children:(0,U.jsx)(P.A,{})})]}),(0,U.jsx)(a.A,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:.5},children:0===q.tags.length?(0,U.jsx)(s.A,{variant:"caption",color:"text.secondary",children:"No tags yet. Add tags to organize your notes."}):q.tags.map((e=>(0,U.jsx)(g.A,{label:e,onDelete:()=>{return t=e,void $({...q,tags:q.tags.filter((e=>e!==t))});var t},color:"primary",variant:"outlined",sx:{"& .MuiChip-deleteIcon":{color:"primary.main","&:hover":{color:"primary.dark"}}}},e)))})]}),(0,U.jsxs)(a.A,{sx:{mb:2},children:[(0,U.jsx)(w.A,{control:(0,U.jsx)(A.A,{checked:q.isEncrypted,onChange:e=>$({...q,isEncrypted:e.target.checked})}),label:"Encrypt Note"}),(0,U.jsx)(h.A,{onClick:()=>{q.isLocked?($({...q,isLocked:!1,lockPasscode:"",content:F||q.content}),G(""),ne(!1)):(G(q.content),ae(!0),H(!0))},color:q.isLocked?"primary":"default",children:q.isLocked?(0,U.jsx)(E.A,{}):(0,U.jsx)(j.A,{})})]}),(0,U.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3},children:[(0,U.jsx)(a.A,{children:ce&&!me&&(0,U.jsx)(s.A,{variant:"caption",color:"warning.main",children:"You have unsaved changes"})}),(0,U.jsxs)(a.A,{children:[(0,U.jsx)(y.A,{type:"submit",variant:"contained",startIcon:(0,U.jsx)(_.A,{}),sx:{mr:1},disabled:me,children:me?"Saving...":"Save"}),(0,U.jsx)(y.A,{variant:"outlined",onClick:()=>{if(ce){if(!window.confirm("You have unsaved changes. Are you sure? Any unsaved work will be lost."))return}t("/")},children:"Cancel"})]})]}),(0,U.jsxs)(v.A,{open:M,onClose:()=>{"new"===e?H(!1):t("/")},children:[(0,U.jsx)(f.A,{children:"new"===e?"Set Note Passcode":"Enter Note Passcode"}),(0,U.jsx)(x.A,{children:(0,U.jsx)(c.A,{autoFocus:!0,margin:"dense",label:"Passcode",type:"password",fullWidth:!0,value:Z,onChange:e=>ee(e.target.value),error:re>0,helperText:re>0?3-re+" attempts remaining":""})}),(0,U.jsxs)(I.A,{children:[(0,U.jsx)(y.A,{onClick:()=>t("/"),children:"Cancel"}),(0,U.jsx)(y.A,{onClick:async()=>{try{se?($({...q,isLocked:!0,lockPasscode:Z}),ne(!0),ae(!1),H(!1)):e&&"new"!==e&&await ge(Z),ee(""),J("")}catch(B){var t,n;console.error("Passcode submission error:",B),J((null===(t=B.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Error submitting passcode")}},variant:"contained",disabled:re>=3,children:"new"===e?"Set Passcode":"Submit"})]})]})]})}}}]);
//# sourceMappingURL=194.54624f56.chunk.js.map