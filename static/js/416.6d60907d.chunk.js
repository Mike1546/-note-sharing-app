"use strict";(self.webpackChunknote_sharing_app_client=self.webpackChunknote_sharing_app_client||[]).push([[416],{416:(e,t,r)=>{r.r(t),r.d(t,{default:()=>re});var n=r(5043),o=r(3216),s=r(8903),a=r(2110),i=r(6494),l=r(5865),d=r(6446),c=r(3845),u=r(7600),m=r(7392),h=r(547),x=r(4912),p=r(4056),A=r(3438),y=r(7784),g=r(1787),b=r(3336),j=r(1637),v=r(35),f=r(6600),w=r(5316),C=r(9347),k=r(3560),I=r(3817),S=r(3768),N=r(141),L=r(9484),X=r(8400),D=r(5016),W=r(6931),G=r(3248),$=r(7097),F=r(2423);var _=r(1344),T=r(5721),q=r(4628),E=r(8734),z=r(8266),U=r(279),M=r(5275),K=r(6649),O=r(2101),P=r(8293),B=r(5626),J=r(6717),Y=r(579);const Q=e=>{let{groups:t,onUpdate:r,onDelete:u,groupNotesMap:x={}}=e;const p=(0,o.Zp)(),[g,b]=(0,n.useState)(!1),[j,k]=(0,n.useState)(null),[I,N]=(0,n.useState)(!1),[L,X]=(0,n.useState)(""),[D,W]=(0,n.useState)(""),[G,$]=(0,n.useState)(""),[F,_]=(0,n.useState)(""),[Q,Z]=(0,n.useState)({});return(0,Y.jsxs)(d.A,{children:[G&&(0,Y.jsx)(h.A,{severity:"error",sx:{mb:2},children:G}),F&&(0,Y.jsx)(h.A,{severity:"success",sx:{mb:2},children:F}),(0,Y.jsx)(T.A,{children:Array.isArray(t)&&t.map((e=>{const t=e._id||e.$id,n=x[t]||[],o=Q[t],u=e.noteCount||n.length;return(0,Y.jsxs)(a.A,{sx:{mb:2},children:[(0,Y.jsxs)(q.Ay,{children:[(0,Y.jsx)(E.A,{primary:(0,Y.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Y.jsx)(l.A,{variant:"h6",children:e.name}),u>0&&(0,Y.jsx)(c.A,{label:`${u} ${1===u?"note":"notes"}`,size:"small",color:"primary",icon:(0,Y.jsx)(M.A,{})})]}),secondaryTypographyProps:{component:"div"},secondary:(0,Y.jsxs)(d.A,{component:"div",children:[e.description&&(0,Y.jsx)(l.A,{component:"div",variant:"body2",color:"text.secondary",sx:{mt:.5},children:e.description}),(0,Y.jsx)(d.A,{component:"div",sx:{mt:1,display:"flex",flexWrap:"wrap",gap:.5},children:e.membersWithInfo&&Array.isArray(e.membersWithInfo)&&e.membersWithInfo.length>0?e.membersWithInfo.map(((e,n)=>{const o=e.nickname||e.name||e.email||"Unknown";return(0,Y.jsx)(c.A,{label:o,size:"small",color:"default",onDelete:()=>(async(e,t)=>{try{await J.Ay.removeMemberFromGroup(e,t),_("Member removed successfully"),setTimeout((()=>_("")),3e3),r()}catch(n){console.error("Remove member error:",n),$((null===n||void 0===n?void 0:n.message)||"Failed to remove member"),setTimeout((()=>$("")),5e3)}})(t,e.userId),deleteIcon:(0,Y.jsx)(K.A,{}),title:e.nickname?`${e.name} (${e.email})`:e.email},e.userId||n)})):(0,Y.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"No members yet"})})]})}),(0,Y.jsxs)(z.A,{children:[(0,Y.jsx)(m.A,{edge:"end","aria-label":o?"collapse":"expand",onClick:()=>(e=>{Z((t=>({...t,[e]:!t[e]})))})(t),sx:{mr:1},children:o?(0,Y.jsx)(O.A,{}):(0,Y.jsx)(P.A,{})}),(0,Y.jsx)(m.A,{edge:"end","aria-label":"add member",onClick:()=>(e=>{k(e),N(!0)})(e),sx:{mr:1},children:(0,Y.jsx)(B.A,{})}),(0,Y.jsx)(m.A,{edge:"end","aria-label":"delete",onClick:()=>(e=>{k(e),b(!0)})(e),children:(0,Y.jsx)(S.A,{})})]})]}),(0,Y.jsx)(U.A,{in:o,timeout:"auto",unmountOnExit:!0,children:(0,Y.jsx)(i.A,{sx:{pt:0},children:0===n.length?(0,Y.jsxs)(d.A,{sx:{textAlign:"center",py:3},children:[(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"No notes in this group yet"}),(0,Y.jsx)(A.A,{size:"small",variant:"outlined",startIcon:(0,Y.jsx)(M.A,{}),onClick:()=>p(`/notes/new?groupId=${t}`),sx:{mt:1},children:"Add Note to Group"})]}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,Y.jsxs)(l.A,{variant:"subtitle2",color:"text.secondary",children:[n.length," ",1===n.length?"note":"notes"," in this group"]}),(0,Y.jsx)(A.A,{size:"small",variant:"outlined",startIcon:(0,Y.jsx)(M.A,{}),onClick:()=>p(`/notes/new?groupId=${t}`),children:"Add Note"})]}),(0,Y.jsx)(s.Ay,{container:!0,spacing:1,children:n.map((e=>{var t;return(0,Y.jsx)(s.Ay,{item:!0,xs:12,sm:6,children:(0,Y.jsx)(a.A,{variant:"outlined",sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>p(`/notes/${e._id}`),children:(0,Y.jsxs)(i.A,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[(0,Y.jsx)(l.A,{variant:"subtitle2",noWrap:!0,children:e.title||"Untitled Note"}),(0,Y.jsxs)(l.A,{variant:"caption",color:"text.secondary",sx:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mt:.5},children:[(null===(t=e.content)||void 0===t?void 0:t.substring(0,60))||"No content","..."]})]})})},e._id)}))})]})})})]},t)}))}),(0,Y.jsxs)(v.A,{open:g,onClose:()=>b(!1),children:[(0,Y.jsx)(f.A,{children:"Delete Group"}),(0,Y.jsx)(w.A,{children:"Are you sure you want to delete this group?"}),(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(A.A,{onClick:()=>b(!1),children:"Cancel"}),(0,Y.jsx)(A.A,{onClick:async()=>{if(u)await u(j._id||j.$id);else try{await J.Ay.deleteGroup(j._id||j.$id),r()}catch(e){return console.error("Delete error:",e),$("Failed to delete group"),void setTimeout((()=>$("")),3e3)}b(!1),_("Group deleted successfully"),setTimeout((()=>_("")),3e3)},color:"error",children:"Delete"})]})]}),(0,Y.jsxs)(v.A,{open:I,onClose:()=>{N(!1),X(""),W("")},maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsx)(f.A,{children:"Add Member"}),(0,Y.jsxs)(w.A,{children:[(0,Y.jsx)(y.A,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,value:L,onChange:e=>X(e.target.value),required:!0,sx:{mb:2,mt:2}}),(0,Y.jsx)(y.A,{margin:"dense",label:"Nickname (Optional)",fullWidth:!0,value:D,onChange:e=>W(e.target.value),placeholder:"Enter a nickname for this member",helperText:"Leave empty to use their name"})]}),(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(A.A,{onClick:()=>{N(!1),X(""),W("")},children:"Cancel"}),(0,Y.jsx)(A.A,{onClick:async()=>{if(!L.trim())return $("Please enter an email address"),void setTimeout((()=>$("")),3e3);try{await J.Ay.addMemberToGroup(j.$id||j._id,L.trim(),D.trim()),N(!1),X(""),W(""),_("Member added successfully"),setTimeout((()=>_("")),3e3),r()}catch(e){console.error("Add member error:",e),$((null===e||void 0===e?void 0:e.message)||"Failed to add member"),setTimeout((()=>$("")),5e3)}},color:"primary",disabled:!L.trim(),children:"Add"})]})]})]})},Z=e=>{let{onSubmit:t,onCancel:r}=e;const{user:o}=(0,D.A)(),[s,a]=(0,n.useState)({name:"",description:""}),[i,l]=(0,n.useState)(""),[c,u]=(0,n.useState)(!1),m=e=>{a({...s,[e.target.name]:e.target.value})};return(0,Y.jsxs)(d.A,{component:"form",onSubmit:async e=>{if(e.preventDefault(),null!==o&&void 0!==o&&o.$id)if(s.name.trim()){u(!0),l("");try{const e=await J.Ay.createGroup(o.$id,s);t(e)}catch(r){console.error("Error creating group:",r),l((null===r||void 0===r?void 0:r.message)||"Failed to create group")}finally{u(!1)}}else l("Group name is required");else l("Not authenticated")},children:[i&&(0,Y.jsx)(h.A,{severity:"error",sx:{mb:2},children:i}),(0,Y.jsx)(y.A,{fullWidth:!0,label:"Group Name",name:"name",value:s.name,onChange:m,required:!0,sx:{mb:2}}),(0,Y.jsx)(y.A,{fullWidth:!0,label:"Description",name:"description",value:s.description,onChange:m,multiline:!0,rows:3,sx:{mb:3}}),(0,Y.jsxs)(d.A,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[(0,Y.jsx)(A.A,{onClick:r,children:"Cancel"}),(0,Y.jsx)(A.A,{type:"submit",variant:"contained",color:"primary",disabled:c||!s.name.trim(),children:c?"Creating...":"Create Group"})]})]})};var H=r(8185);const R=e=>{let{count:t=6}=e;return(0,Y.jsx)(s.Ay,{container:!0,spacing:2,children:Array.from({length:t}).map(((e,t)=>(0,Y.jsx)(s.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,Y.jsx)(a.A,{children:(0,Y.jsxs)(i.A,{children:[(0,Y.jsx)(H.A,{variant:"text",width:"60%",height:32,sx:{mb:1}}),(0,Y.jsx)(H.A,{variant:"text",width:"100%",height:20}),(0,Y.jsx)(H.A,{variant:"text",width:"80%",height:20}),(0,Y.jsxs)(d.A,{sx:{display:"flex",gap:1,mt:2},children:[(0,Y.jsx)(H.A,{variant:"rectangular",width:60,height:24}),(0,Y.jsx)(H.A,{variant:"rectangular",width:60,height:24})]})]})})},t)))})};var V=r(446),ee=r.n(V);const te=n.memo((e=>{var t,r;let{note:n,onEdit:o,onDelete:h,onShare:x}=e;const p=(null===(t=n.content)||void 0===t?void 0:t.substring(0,150))||"",A=(null===(r=n.content)||void 0===r?void 0:r.length)>150;return(0,Y.jsx)(s.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,Y.jsxs)(a.A,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease-in-out","&:hover":{boxShadow:6,transform:"translateY(-4px)"}},children:[(0,Y.jsxs)(i.A,{sx:{flexGrow:1,pb:1},children:[(0,Y.jsx)(l.A,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"medium",mb:1.5,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:n.title||"Untitled Note"}),(0,Y.jsxs)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",minHeight:"60px"},children:[p,A&&"..."]}),n.tags&&n.tags.length>0&&(0,Y.jsxs)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:[n.tags.slice(0,3).map(((e,t)=>(0,Y.jsx)(c.A,{label:e,size:"small",sx:{fontSize:"0.7rem",height:"24px",backgroundColor:"primary.light",color:"primary.contrastText"}},t))),n.tags.length>3&&(0,Y.jsx)(c.A,{label:"+"+(n.tags.length-3),size:"small",sx:{fontSize:"0.7rem",height:"24px"}})]}),n.createdAt&&(0,Y.jsx)(l.A,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:ee()(n.createdAt).format("MMM D, YYYY")})]}),(0,Y.jsxs)(u.A,{sx:{px:2,pb:2,pt:1},children:[(0,Y.jsx)(m.A,{size:"small",onClick:()=>o(n._id),sx:{"&:hover":{color:"primary.main",backgroundColor:"action.hover"}},"aria-label":"Edit note",children:(0,Y.jsx)(k.A,{fontSize:"small"})}),(0,Y.jsx)(m.A,{size:"small",onClick:()=>x(n),sx:{"&:hover":{color:"info.main",backgroundColor:"action.hover"}},"aria-label":"Share note",children:(0,Y.jsx)(I.A,{fontSize:"small"})}),(0,Y.jsx)(m.A,{size:"small",onClick:()=>h(n._id),sx:{ml:"auto","&:hover":{color:"error.main",backgroundColor:"error.lighter"}},"aria-label":"Delete note",children:(0,Y.jsx)(S.A,{fontSize:"small"})})]})]})},n._id)}));te.displayName="NoteCard";const re=()=>{const e=(0,o.Zp)(),{user:t}=(0,D.A)(),[r,a]=(0,n.useState)(!1),[i,u]=(0,n.useState)(null),[m,k]=(0,n.useState)(""),[I,S]=(0,n.useState)("view"),[T,q]=(0,n.useState)(0),[E,z]=(0,n.useState)(!1),[U,M]=(0,n.useState)(""),[K,O]=(0,n.useState)(""),[P,B]=(0,n.useState)(""),[J,H]=(0,n.useState)("all"),{data:V=[],isLoading:ee,error:re}=(ne=null===t||void 0===t?void 0:t.$id,(0,W.I)({queryKey:["notes",ne],queryFn:async()=>{const e=await F.Ay.listNotes(ne);return((null===e||void 0===e?void 0:e.documents)||e||[]).map((e=>({_id:e.$id,title:e.title||"",content:e.content||"",tags:e.tags||[],group:e.groupId||null,ownerId:e.ownerId,owner:e.owner||null,createdAt:e.createdAt,updatedAt:e.updatedAt})))},enabled:!!ne,staleTime:12e4}));var ne;const{data:oe=[],isLoading:se,error:ae}=(0,_._i)(null===t||void 0===t?void 0:t.$id),ie=(()=>{const e=(0,G.jE)();return(0,$.n)({mutationFn:async e=>{let{noteId:t,userId:r}=e;return await F.Ay.deleteNote(t,r)},onSuccess:(t,r)=>{e.invalidateQueries(["notes",r.userId])}})})(),le=(0,_.rK)(),de=(0,_.cq)(),ce=(0,n.useMemo)((()=>{const e={};return oe.forEach((t=>{e[t._id]=V.filter((e=>(e.group||e.groupId)===t._id))})),e}),[oe,V]),ue=(0,n.useMemo)((()=>{let e=V;if("personal"===J?e=e.filter((e=>!e.group&&!e.groupId)):"grouped"===J&&(e=e.filter((e=>e.group||e.groupId))),P.trim()){const t=P.toLowerCase();e=e.filter((e=>{var r,n,o;return(null===(r=e.title)||void 0===r?void 0:r.toLowerCase().includes(t))||(null===(n=e.content)||void 0===n?void 0:n.toLowerCase().includes(t))||(null===(o=e.tags)||void 0===o?void 0:o.some((e=>e.toLowerCase().includes(t))))}))}return e}),[V,P,J]),me=(0,n.useMemo)((()=>ue.filter((e=>!e.group&&!e.groupId))),[ue]),he=(0,n.useCallback)((t=>{e(`/notes/${t}`)}),[e]),xe=(0,n.useCallback)((async e=>{if(window.confirm("Are you sure you want to delete this note?"))try{await ie.mutateAsync({noteId:e,userId:t.$id}),O("Note deleted successfully"),setTimeout((()=>O("")),3e3)}catch(U){console.error("Error deleting note:",U),M("Failed to delete note"),setTimeout((()=>M("")),3e3)}}),[ie,null===t||void 0===t?void 0:t.$id]),pe=(0,n.useCallback)((e=>{u(e),a(!0)}),[]),Ae=(0,n.useCallback)((async()=>{a(!1),O("Sharing not available yet"),setTimeout((()=>O("")),3e3)}),[]),ye=(0,n.useCallback)((async e=>{try{await le.mutateAsync({userId:t.$id,groupData:e}),z(!1),O("Group created successfully"),setTimeout((()=>O("")),3e3)}catch(U){console.error("Error creating group:",U),M("Failed to create group"),setTimeout((()=>M("")),3e3)}}),[le,null===t||void 0===t?void 0:t.$id]),ge=(0,n.useCallback)(((e,t)=>{q(t)}),[]),be=(0,n.useCallback)((async e=>{if(window.confirm("Are you sure you want to delete this group?"))try{await de.mutateAsync({groupId:e,userId:t.$id}),O("Group deleted successfully"),setTimeout((()=>O("")),3e3)}catch(r){console.error("Delete error:",r),M("Failed to delete group"),setTimeout((()=>M("")),3e3)}}),[de,null===t||void 0===t?void 0:t.$id]);return(re||ae)&&M("Failed to load data"),(0,Y.jsxs)(d.A,{children:[U&&(0,Y.jsx)(h.A,{severity:"error",sx:{mb:2},onClose:()=>M(""),children:U}),K&&(0,Y.jsx)(h.A,{severity:"success",sx:{mb:2},onClose:()=>O(""),children:K}),(0,Y.jsxs)(x.A,{value:T,onChange:ge,sx:{mb:3},children:[(0,Y.jsx)(p.A,{label:"My Notes"}),(0,Y.jsx)(p.A,{label:"Note Groups"})]}),(0,Y.jsxs)(d.A,{sx:{mt:2},children:[0===T&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(d.A,{sx:{mb:3,display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:{xs:"stretch",sm:"center"}},children:[(0,Y.jsx)(A.A,{variant:"contained",startIcon:(0,Y.jsx)(N.A,{}),onClick:()=>e("/notes/new"),sx:{minWidth:{xs:"100%",sm:"auto"}},children:"New Note"}),(0,Y.jsx)(y.A,{fullWidth:!0,placeholder:"Search notes...",value:P,onChange:e=>B(e.target.value),InputProps:{startAdornment:(0,Y.jsx)(g.A,{position:"start",children:(0,Y.jsx)(L.A,{})})},sx:{maxWidth:{sm:"400px"}}}),(0,Y.jsxs)(d.A,{sx:{display:"flex",gap:1},children:[(0,Y.jsx)(c.A,{label:"All",onClick:()=>H("all"),color:"all"===J?"primary":"default",clickable:!0}),(0,Y.jsx)(c.A,{label:"Personal",onClick:()=>H("personal"),color:"personal"===J?"primary":"default",clickable:!0}),(0,Y.jsx)(c.A,{label:"Grouped",onClick:()=>H("grouped"),color:"grouped"===J?"primary":"default",clickable:!0})]})]}),ee?(0,Y.jsx)(R,{count:6}):0===me.length?(0,Y.jsxs)(b.A,{sx:{p:6,textAlign:"center",backgroundColor:"background.default",border:"2px dashed",borderColor:"divider"},children:[(0,Y.jsx)(X.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,Y.jsx)(l.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:P||"all"!==J?"No notes found":"No notes yet"}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:P||"all"!==J?"Try adjusting your search or filters":"Create your first note to get started"}),!P&&"all"===J&&(0,Y.jsx)(A.A,{variant:"contained",startIcon:(0,Y.jsx)(N.A,{}),onClick:()=>e("/notes/new"),children:"Create Note"})]}):(0,Y.jsx)(s.Ay,{container:!0,spacing:2,children:me.map((e=>(0,Y.jsx)(te,{note:e,onEdit:he,onDelete:xe,onShare:pe},e._id)))})]}),1===T&&(0,Y.jsxs)(d.A,{children:[(0,Y.jsxs)(d.A,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Y.jsx)(l.A,{variant:"h6",children:"Note Groups"}),(0,Y.jsx)(A.A,{variant:"contained",startIcon:(0,Y.jsx)(N.A,{}),onClick:()=>z(!0),children:"Create Group"})]}),se?(0,Y.jsx)(j.A,{}):0===oe.length?(0,Y.jsxs)(b.A,{sx:{p:6,textAlign:"center",backgroundColor:"background.default",border:"2px dashed",borderColor:"divider"},children:[(0,Y.jsx)(X.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,Y.jsx)(l.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No groups yet"}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Create a group to organize and share notes with others"}),(0,Y.jsx)(A.A,{variant:"contained",startIcon:(0,Y.jsx)(N.A,{}),onClick:()=>z(!0),children:"Create Group"})]}):(0,Y.jsx)(Q,{groups:oe.map((e=>{var t;return{...e,noteCount:(null===(t=ce[e._id||e.$id])||void 0===t?void 0:t.length)||0}})),onUpdate:()=>{},onDelete:be,groupNotesMap:ce})]})]}),(0,Y.jsxs)(v.A,{open:r,onClose:()=>a(!1),maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsx)(f.A,{children:"Share Note"}),(0,Y.jsxs)(w.A,{children:[(0,Y.jsx)(y.A,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,value:m,onChange:e=>k(e.target.value),sx:{mb:2}}),(0,Y.jsxs)(y.A,{select:!0,margin:"dense",label:"Permission",fullWidth:!0,value:I,onChange:e=>S(e.target.value),SelectProps:{native:!0},children:[(0,Y.jsx)("option",{value:"view",children:"View"}),(0,Y.jsx)("option",{value:"edit",children:"Edit"})]})]}),(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(A.A,{onClick:()=>a(!1),children:"Cancel"}),(0,Y.jsx)(A.A,{onClick:Ae,color:"primary",variant:"contained",children:"Share"})]})]}),(0,Y.jsxs)(v.A,{open:E,onClose:()=>z(!1),maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsx)(f.A,{children:"Create Note Group"}),(0,Y.jsx)(w.A,{children:(0,Y.jsx)(Z,{onSubmit:ye,onCancel:()=>z(!1)})})]})]})}},1344:(e,t,r)=>{r.d(t,{_i:()=>i,cq:()=>d,rK:()=>l});var n=r(6931),o=r(3248),s=r(7097),a=r(6717);const i=e=>(0,n.I)({queryKey:["groups",e],queryFn:async()=>(await a.Ay.listGroups(e)).map((e=>({_id:e.$id,name:e.name||"",description:e.description||"",members:e.members||[],membersWithInfo:e.membersWithInfo||[],memberNicknames:e.memberNicknames||{},ownerId:e.ownerId}))),enabled:!!e,staleTime:3e5}),l=()=>{const e=(0,o.jE)();return(0,s.n)({mutationFn:async e=>{let{userId:t,groupData:r}=e;return await a.Ay.createGroup(t,r)},onSuccess:(t,r)=>{e.invalidateQueries(["groups",r.userId])}})},d=()=>{const e=(0,o.jE)();return(0,s.n)({mutationFn:async e=>{let{groupId:t,userId:r}=e;return await a.Ay.deleteGroup(t)},onSuccess:(t,r)=>{e.invalidateQueries(["groups",r.userId])}})}},2423:(e,t,r)=>{r.d(t,{Ay:()=>i});var n=r(5404),o=r(5460);const s="69181c670024df0dd32b",a="6918f63400264192256d";const i={createNote:async function(e,t){const r=[o.aX.read(o.Xh.user(e)),o.aX.update(o.Xh.user(e)),o.aX.delete(o.Xh.user(e)),o.aX.write(o.Xh.user(e))];try{return await n.LL.createDocument(s,a,"unique()",{...t,ownerId:e},r)}catch(d){var i,l;const r=(null===d||void 0===d?void 0:d.message)||(null===d||void 0===d||null===(i=d.response)||void 0===i?void 0:i.message)||"",o=(null===d||void 0===d?void 0:d.code)||(null===d||void 0===d||null===(l=d.response)||void 0===l?void 0:l.code);if(String(r).toLowerCase().includes("permissions")||400===o)return n.LL.createDocument(s,a,"unique()",{...t,ownerId:e});throw d}},listNotes:async function(e){try{const t=(await n.LL.listDocuments(s,a,[o.XK.equal("ownerId",e)])).documents||[],r="6918f632002d42536ab2";return await Promise.all(t.map((async e=>{if(!e.ownerId)return e;try{const t=await n.LL.listDocuments(s,r,[o.XK.equal("userId",e.ownerId)]);if(t.documents&&t.documents.length>0){const r=t.documents[0];return{...e,owner:{name:r.name||r.email||"Unknown",email:r.email||""}}}return{...e,owner:{name:"Unknown User",email:""}}}catch(t){return console.warn(`Failed to fetch profile for owner ${e.ownerId}:`,t),{...e,owner:{name:"Unknown User",email:""}}}})))}catch(t){try{const t=await n.LL.listDocuments(s,a);return t.documents=(t.documents||[]).filter((t=>t.ownerId===e)),t}catch(r){throw t}}},updateNote:async function(e,t,r){return n.LL.updateDocument(s,a,e,r)},deleteNote:async function(e){return n.LL.deleteDocument(s,a,e)}}},6717:(e,t,r)=>{r.d(t,{Ay:()=>i});var n=r(5404),o=r(5460);const s="69181c670024df0dd32b",a="6918f637002e49bd5482";const i={listGroups:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=[];t.push(o.XK.or([o.XK.equal("type","note"),o.XK.isNull("type")])),e&&t.push(o.XK.equal("ownerId",e));const r=(await n.LL.listDocuments(s,a,t)).documents||[],i="6918f632002d42536ab2";return await Promise.all(r.map((async e=>{if(!e.members||!Array.isArray(e.members))return{...e,membersWithInfo:[]};let t={};try{t=e.memberNicknames?JSON.parse(e.memberNicknames):{}}catch(a){t={}}const r=await Promise.all(e.members.map((async e=>{try{const r=await n.LL.listDocuments(s,i,[o.XK.equal("userId",e)]);if(r.documents&&r.documents.length>0){const n=r.documents[0];return{userId:e,name:n.name||n.email||"Unknown",email:n.email||"",nickname:t[e]||""}}return{userId:e,name:"Unknown User",email:"",nickname:t[e]||""}}catch(r){return console.warn(`Failed to fetch profile for ${e}:`,r),{userId:e,name:"Unknown User",email:"",nickname:t[e]||""}}})));return{...e,membersWithInfo:r}})))}catch(t){return console.warn("Failed to fetch groups:",t),[]}},createGroup:async function(e,t){try{const{name:r,description:i}=t;if(!r)throw new Error("Group name is required");const l=[o.aX.read(o.Xh.user(e)),o.aX.update(o.Xh.user(e)),o.aX.delete(o.Xh.user(e)),o.aX.read(o.Xh.users())];return await n.LL.createDocument(s,a,o.ID.unique(),{ownerId:e,name:r.trim(),description:i||"",members:[],memberNicknames:"{}",type:"note"},l)}catch(r){throw console.error("Failed to create group:",r),r}},addMemberToGroup:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const l=await n.LL.getDocument(s,a,e),d="6918f632002d42536ab2",c=await n.LL.listDocuments(s,d,[o.XK.equal("email",t.toLowerCase())]);if(!c.documents||0===c.documents.length)throw new Error("User not found with that email");const u=c.documents[0].userId,m=l.members||[];let h={};try{h=l.memberNicknames?JSON.parse(l.memberNicknames):{}}catch(i){h={}}if(m.includes(u))throw new Error("User is already a member of this group");const x=[...m,u];r.trim()&&(h[u]=r.trim());const p=[o.aX.read(o.Xh.user(l.ownerId)),o.aX.update(o.Xh.user(l.ownerId)),o.aX.delete(o.Xh.user(l.ownerId)),o.aX.read(o.Xh.users())];return await n.LL.updateDocument(s,a,e,{members:x,memberNicknames:JSON.stringify(h)},p)}catch(l){throw console.error("Failed to add member:",l),l}},removeMemberFromGroup:async function(e,t){try{const i=await n.LL.getDocument(s,a,e),l=(i.members||[]).filter((e=>e!==t));let d={};try{d=i.memberNicknames?JSON.parse(i.memberNicknames):{}}catch(r){d={}}delete d[t];const c=[o.aX.read(o.Xh.user(i.ownerId)),o.aX.update(o.Xh.user(i.ownerId)),o.aX.delete(o.Xh.user(i.ownerId)),o.aX.read(o.Xh.users())];return await n.LL.updateDocument(s,a,e,{members:l,memberNicknames:JSON.stringify(d)},c)}catch(i){throw console.error("Failed to remove member:",i),i}},deleteGroup:async function(e){try{return await n.LL.deleteDocument(s,a,e)}catch(t){throw console.error("Failed to delete group:",t),t}}}}}]);
//# sourceMappingURL=416.6d60907d.chunk.js.map